/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();const e=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},n={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let e=0;e<t.length;e+=3){const i=t[e],s=e+1<t.length,o=s?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,u=i>>2,h=(3&i)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(l=64)),r.push(n[u],n[h],n[l],n[d])}return r.join("")},encodeString(t,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(t):this.encodeByteArray(e(t),n)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(s>>10)),e[r++]=String.fromCharCode(56320+(1023&s))}else{const s=t[n++],o=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let e=0;e<t.length;){const s=n[t.charAt(e++)],o=e<t.length?n[t.charAt(e)]:0;++e;const a=e<t.length?n[t.charAt(e)]:64;++e;const c=e<t.length?n[t.charAt(e)]:64;if(++e,null==s||null==o||null==a||null==c)throw new r;const u=s<<2|o>>4;if(i.push(u),64!==a){const t=o<<4&240|a>>2;if(i.push(t),64!==c){const t=a<<6&192|c;i.push(t)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class r extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const i=function(t){return function(t){const r=e(t);return n.encodeByteArray(r,!0)}(t).replace(/\./g,"")},s=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t.g)return t.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&function(t){try{return n.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},o=()=>{var t;return null===(t=s())||void 0===t?void 0:t.config};class a{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function c(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function u(){try{return"object"==typeof indexedDB}catch(t){return!1}}class h extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,h.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,l.prototype.create)}}class l{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},r=`${this.service}/${t}`,i=this.errors[t],s=i?function(t,e){return t.replace(d,((t,n)=>{const r=e[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new h(r,o,n)}}const d=/\{\$([^}]+)}/g;function f(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const n=t[i],s=e[i];if(g(n)&&g(s)){if(!f(n,s))return!1}else if(n!==s)return!1}for(const t of r)if(!n.includes(t))return!1;return!0}function g(t){return null!==t&&"object"==typeof t}function p(t){return t&&t._delegate?t._delegate:t}class m{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const y="[DEFAULT]";class v{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new a;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(r)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:y})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=y){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=y){return this.instances.has(t)}getOptions(t=y){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(r);return r}onInit(t,e){var n;const r=this.normalizeInstanceIdentifier(e),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(t),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&t(s,r),()=>{i.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const r of n)try{r(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===y?void 0:r),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var r;return n||null}normalizeInstanceIdentifier(t=y){return this.component?this.component.multipleInstances?t:y:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class w{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new v(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const b=[];var E;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(E||(E={}));const _={debug:E.DEBUG,verbose:E.VERBOSE,info:E.INFO,warn:E.WARN,error:E.ERROR,silent:E.SILENT},T=E.INFO,S={[E.DEBUG]:"log",[E.VERBOSE]:"log",[E.INFO]:"info",[E.WARN]:"warn",[E.ERROR]:"error"},I=(t,e,...n)=>{if(e<t.logLevel)return;const r=(new Date).toISOString(),i=S[e];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[i](`[${r}]  ${t.name}:`,...n)};class C{constructor(t){this.name=t,this._logLevel=T,this._logHandler=I,this._userLogHandler=null,b.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in E))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?_[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,E.DEBUG,...t),this._logHandler(this,E.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,E.VERBOSE,...t),this._logHandler(this,E.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,E.INFO,...t),this._logHandler(this,E.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,E.WARN,...t),this._logHandler(this,E.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,E.ERROR,...t),this._logHandler(this,E.ERROR,...t)}}const D=(t,e)=>e.some((e=>t instanceof e));let A,k;const N=new WeakMap,x=new WeakMap,M=new WeakMap,L=new WeakMap,O=new WeakMap;let R={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return x.get(t);if("objectStoreNames"===e)return t.objectStoreNames||M.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return F(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function P(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(k||(k=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(V(this),t),F(N.get(this))}:function(...t){return F(e.apply(V(this),t))}:function(t,...n){const r=e.call(V(this),t,...n);return M.set(r,t.sort?t.sort():[t]),F(r)}:(t instanceof IDBTransaction&&function(t){if(x.has(t))return;const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",s),t.removeEventListener("abort",s)},i=()=>{e(),r()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",s),t.addEventListener("abort",s)}));x.set(t,e)}(t),D(t,A||(A=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,R):t);var e}function F(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",s)},i=()=>{e(F(t.result)),r()},s=()=>{n(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",s)}));return e.then((e=>{e instanceof IDBCursor&&N.set(e,t)})).catch((()=>{})),O.set(e,t),e}(t);if(L.has(t))return L.get(t);const e=P(t);return e!==t&&(L.set(t,e),O.set(e,t)),e}const V=t=>O.get(t),U=["get","getKey","getAll","getAllKeys","count"],B=["put","add","delete","clear"],j=new Map;function q(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(j.get(e))return j.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=B.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!U.includes(n))return;const s=async function(t,...e){const s=this.transaction(t,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),i&&s.done]))[0]};return j.set(e,s),s}var $;$=R,R={...$,get:(t,e,n)=>q(t,e)||$.get(t,e,n),has:(t,e)=>!!q(t,e)||$.has(t,e)};class z{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const G="@firebase/app",K="0.10.0",H=new C("@firebase/app"),Q="[DEFAULT]",W={[G]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},Y=new Map,X=new Map,J=new Map;function Z(t,e){try{t.container.addComponent(e)}catch(n){H.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function tt(t){const e=t.name;if(J.has(e))return H.debug(`There were multiple attempts to register component ${e}.`),!1;J.set(e,t);for(const e of Y.values())Z(e,t);for(const e of X.values())Z(e,t);return!0}const et=new l("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class nt{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new m("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw et.create("app-deleted",{appName:this._name})}}function rt(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const r=Object.assign({name:Q,automaticDataCollectionEnabled:!1},e),i=r.name;if("string"!=typeof i||!i)throw et.create("bad-app-name",{appName:String(i)});if(n||(n=o()),!n)throw et.create("no-options");const s=Y.get(i);if(s){if(f(n,s.options)&&f(r,s.config))return s;throw et.create("duplicate-app",{appName:i})}const a=new w(i);for(const t of J.values())a.addComponent(t);const c=new nt(n,r,a);return Y.set(i,c),c}function it(t,e,n){var r;let i=null!==(r=W[t])&&void 0!==r?r:t;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const t=[`Unable to register library "${i}" with version "${e}":`];return s&&t.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void H.warn(t.join(" "))}tt(new m(`${i}-version`,(()=>({library:i,version:e})),"VERSION"))}const st="firebase-heartbeat-database",ot=1,at="firebase-heartbeat-store";let ct=null;function ut(){return ct||(ct=function(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(t,e),a=F(o);return r&&o.addEventListener("upgradeneeded",(t=>{r(F(o.result),t.oldVersion,t.newVersion,F(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{s&&t.addEventListener("close",(()=>s())),i&&t.addEventListener("versionchange",(t=>i(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}(st,ot,{upgrade:(t,e)=>{if(0===e)try{t.createObjectStore(at)}catch(t){console.warn(t)}}}).catch((t=>{throw et.create("idb-open",{originalErrorMessage:t.message})}))),ct}async function ht(t,e){try{const n=(await ut()).transaction(at,"readwrite"),r=n.objectStore(at);await r.put(e,lt(t)),await n.done}catch(t){if(t instanceof h)H.warn(t.message);else{const e=et.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});H.warn(e.message)}}}function lt(t){return`${t.name}!${t.options.appId}`}class dt{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new gt(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){var t,e;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=ft();if((null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==r&&!this._heartbeatsCache.heartbeats.some((t=>t.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var t;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=ft(),{heartbeatsToSend:n,unsentEntries:r}=function(t,e=1024){const n=[];let r=t.slice();for(const i of t){const t=n.find((t=>t.agent===i.agent));if(t){if(t.dates.push(i.date),pt(n)>e){t.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),pt(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),s=i(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}}function ft(){return(new Date).toISOString().substring(0,10)}class gt{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!u()&&new Promise(((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var t;e((null===(t=i.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=(await ut()).transaction(at),n=await e.objectStore(at).get(lt(t));return await e.done,n}catch(t){if(t instanceof h)H.warn(t.message);else{const e=et.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});H.warn(e.message)}}}(this.app);return(null==t?void 0:t.heartbeats)?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return ht(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return ht(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function pt(t){return i(JSON.stringify({version:2,heartbeats:t})).length}tt(new m("platform-logger",(t=>new z(t)),"PRIVATE")),tt(new m("heartbeat",(t=>new dt(t)),"PRIVATE")),it(G,K,""),it(G,K,"esm2017"),it("fire-js",""),it("firebase","10.10.0","app");var mt,yt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},vt={},wt=wt||{},bt=yt||self;function Et(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function _t(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Tt="closure_uid_"+(1e9*Math.random()>>>0),St=0;function It(t,e,n){return t.call.apply(t.bind,arguments)}function Ct(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function Dt(t,e,n){return(Dt=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?It:Ct).apply(null,arguments)}function At(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function kt(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(t,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return e.prototype[n].apply(t,i)}}function Nt(){this.s=this.s,this.o=this.o}Nt.prototype.s=!1,Nt.prototype.sa=function(){var t;!this.s&&(this.s=!0,this.N(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,Tt)&&t[Tt]||(t[Tt]=++St))},Nt.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const xt=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function Mt(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function Lt(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(Et(n)){const e=t.length||0,r=n.length||0;t.length=e+r;for(let i=0;i<r;i++)t[e+i]=n[i]}else t.push(n)}}function Ot(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}Ot.prototype.h=function(){this.defaultPrevented=!0};var Rt=function(){if(!bt.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};bt.addEventListener("test",t,e),bt.removeEventListener("test",t,e)}catch(t){}return t}();function Pt(t){return/^[\s\xa0]*$/.test(t)}function Ft(){var t=bt.navigator;return t&&(t=t.userAgent)?t:""}function Vt(t){return-1!=Ft().indexOf(t)}function Ut(t){return Ut[" "](t),t}Ut[" "]=function(){};var Bt,jt,qt,$t=Vt("Opera"),zt=Vt("Trident")||Vt("MSIE"),Gt=Vt("Edge"),Kt=Gt||zt,Ht=Vt("Gecko")&&!(-1!=Ft().toLowerCase().indexOf("webkit")&&!Vt("Edge"))&&!(Vt("Trident")||Vt("MSIE"))&&!Vt("Edge"),Qt=-1!=Ft().toLowerCase().indexOf("webkit")&&!Vt("Edge");function Wt(){var t=bt.document;return t?t.documentMode:void 0}t:{var Yt="",Xt=(jt=Ft(),Ht?/rv:([^\);]+)(\)|;)/.exec(jt):Gt?/Edge\/([\d\.]+)/.exec(jt):zt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(jt):Qt?/WebKit\/(\S+)/.exec(jt):$t?/(?:Version)[ \/]?(\S+)/.exec(jt):void 0);if(Xt&&(Yt=Xt?Xt[1]:""),zt){var Jt=Wt();if(null!=Jt&&Jt>parseFloat(Yt)){Bt=String(Jt);break t}}Bt=Yt}bt.document&&zt?qt=Wt()||parseInt(Bt,10)||void 0:qt=void 0;var Zt=qt;function te(t,e){if(Ot.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(Ht){t:{try{Ut(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:ee[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&te.$.h.call(this)}}kt(te,Ot);var ee={2:"touch",3:"pen",4:"mouse"};te.prototype.h=function(){te.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var ne="closure_listenable_"+(1e6*Math.random()|0),re=0;function ie(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.la=i,this.key=++re,this.fa=this.ia=!1}function se(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function oe(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function ae(t){const e={};for(const n in t)e[n]=t[n];return e}const ce="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ue(t,e){let n,r;for(let e=1;e<arguments.length;e++){for(n in r=arguments[e],r)t[n]=r[n];for(let e=0;e<ce.length;e++)n=ce[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function he(t){this.src=t,this.g={},this.h=0}function le(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],s=xt(i,e);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(se(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function de(t,e,n,r){for(var i=0;i<t.length;++i){var s=t[i];if(!s.fa&&s.listener==e&&s.capture==!!n&&s.la==r)return i}return-1}he.prototype.add=function(t,e,n,r,i){var s=t.toString();(t=this.g[s])||(t=this.g[s]=[],this.h++);var o=de(t,e,r,i);return-1<o?(e=t[o],n||(e.ia=!1)):((e=new ie(e,this.src,s,!!r,i)).ia=n,t.push(e)),e};var fe="closure_lm_"+(1e6*Math.random()|0),ge={};function pe(t,e,n,r,i){if(r&&r.once)return ye(t,e,n,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)pe(t,e[s],n,r,i);return null}return n=Se(n),t&&t[ne]?t.O(e,n,_t(r)?!!r.capture:!!r,i):me(t,e,n,!1,r,i)}function me(t,e,n,r,i,s){if(!e)throw Error("Invalid event type");var o=_t(i)?!!i.capture:!!i,a=_e(t);if(a||(t[fe]=a=new he(t)),(n=a.add(e,n,r,o,s)).proxy)return n;if(r=function(){const t=Ee;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)Rt||(i=o),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(be(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function ye(t,e,n,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)ye(t,e[s],n,r,i);return null}return n=Se(n),t&&t[ne]?t.P(e,n,_t(r)?!!r.capture:!!r,i):me(t,e,n,!0,r,i)}function ve(t,e,n,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)ve(t,e[s],n,r,i);else r=_t(r)?!!r.capture:!!r,n=Se(n),t&&t[ne]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=de(s=t.g[e],n,r,i))&&(se(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete t.g[e],t.h--))):t&&(t=_e(t))&&(e=t.g[e.toString()],t=-1,e&&(t=de(e,n,r,i)),(n=-1<t?e[t]:null)&&we(n))}function we(t){if("number"!=typeof t&&t&&!t.fa){var e=t.src;if(e&&e[ne])le(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(be(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=_e(e))?(le(n,t),0==n.h&&(n.src=null,e[fe]=null)):se(t)}}}function be(t){return t in ge?ge[t]:ge[t]="on"+t}function Ee(t,e){if(t.fa)t=!0;else{e=new te(e,this);var n=t.listener,r=t.la||t.src;t.ia&&we(t),t=n.call(r,e)}return t}function _e(t){return(t=t[fe])instanceof he?t:null}var Te="__closure_events_fn_"+(1e9*Math.random()>>>0);function Se(t){return"function"==typeof t?t:(t[Te]||(t[Te]=function(e){return t.handleEvent(e)}),t[Te])}function Ie(){Nt.call(this),this.i=new he(this),this.S=this,this.J=null}function Ce(t,e){var n,r=t.J;if(r)for(n=[];r;r=r.J)n.push(r);if(t=t.S,r=e.type||e,"string"==typeof e)e=new Ot(e,t);else if(e instanceof Ot)e.target=e.target||t;else{var i=e;ue(e=new Ot(r,t),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=e.g=n[s];i=De(o,r,!0,e)&&i}if(i=De(o=e.g=t,r,!0,e)&&i,i=De(o,r,!1,e)&&i,n)for(s=0;s<n.length;s++)i=De(o=e.g=n[s],r,!1,e)&&i}function De(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&le(t.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}kt(Ie,Nt),Ie.prototype[ne]=!0,Ie.prototype.removeEventListener=function(t,e,n,r){ve(this,t,e,n,r)},Ie.prototype.N=function(){if(Ie.$.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)se(n[r]);delete e.g[t],e.h--}}this.J=null},Ie.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},Ie.prototype.P=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var Ae=bt.JSON.stringify;function ke(){var t=Pe;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Ne=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new xe),(t=>t.reset()));class xe{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function Me(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function Le(t){bt.setTimeout((()=>{throw t}),0)}let Oe,Re=!1,Pe=new class{constructor(){this.h=this.g=null}add(t,e){const n=Ne.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},Fe=()=>{const t=bt.Promise.resolve(void 0);Oe=()=>{t.then(Ve)}};var Ve=()=>{for(var t;t=ke();){try{t.h.call(t.g)}catch(t){Le(t)}var e=Ne;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Re=!1};function Ue(t,e){Ie.call(this),this.h=t||1,this.g=e||bt,this.j=Dt(this.qb,this),this.l=Date.now()}function Be(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}function je(t,e,n){if("function"==typeof t)n&&(t=Dt(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Dt(t.handleEvent,t)}return 2147483647<Number(e)?-1:bt.setTimeout(t,e||0)}function qe(t){t.g=je((()=>{t.g=null,t.i&&(t.i=!1,qe(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}kt(Ue,Ie),(mt=Ue.prototype).ga=!1,mt.T=null,mt.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Ce(this,"tick"),this.ga&&(Be(this),this.start()))}},mt.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},mt.N=function(){Ue.$.N.call(this),Be(this),delete this.g};class $e extends Nt{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:qe(this)}N(){super.N(),this.g&&(bt.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ze(t){Nt.call(this),this.h=t,this.g={}}kt(ze,Nt);var Ge=[];function Ke(t,e,n,r){Array.isArray(n)||(n&&(Ge[0]=n.toString()),n=Ge);for(var i=0;i<n.length;i++){var s=pe(e,n[i],r||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}}function He(t){oe(t.g,(function(t,e){this.g.hasOwnProperty(e)&&we(t)}),t),t.g={}}function Qe(){this.g=!0}function We(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return Ae(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}ze.prototype.N=function(){ze.$.N.call(this),He(this)},ze.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Qe.prototype.Ea=function(){this.g=!1},Qe.prototype.info=function(){};var Ye={},Xe=null;function Je(){return Xe=Xe||new Ie}function Ze(t){Ot.call(this,Ye.Ta,t)}function tn(t){const e=Je();Ce(e,new Ze(e))}function en(t,e){Ot.call(this,Ye.STAT_EVENT,t),this.stat=e}function nn(t){const e=Je();Ce(e,new en(e,t))}function rn(t,e){Ot.call(this,Ye.Ua,t),this.size=e}function sn(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return bt.setTimeout((function(){t()}),e)}Ye.Ta="serverreachability",kt(Ze,Ot),Ye.STAT_EVENT="statevent",kt(en,Ot),Ye.Ua="timingevent",kt(rn,Ot);var on={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},an={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function cn(){}function un(t){return t.h||(t.h=t.i())}function hn(){}cn.prototype.h=null;var ln,dn={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function fn(){Ot.call(this,"d")}function gn(){Ot.call(this,"c")}function pn(){}function mn(t,e,n,r){this.l=t,this.j=e,this.m=n,this.W=r||1,this.U=new ze(this),this.P=vn,t=Kt?125:void 0,this.V=new Ue(t),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new yn}function yn(){this.i=null,this.g="",this.h=!1}kt(fn,Ot),kt(gn,Ot),kt(pn,cn),pn.prototype.g=function(){return new XMLHttpRequest},pn.prototype.i=function(){return{}},ln=new pn;var vn=45e3,wn={},bn={};function En(t,e,n){t.L=1,t.A=Bn(Rn(e)),t.u=n,t.S=!0,_n(t,null)}function _n(t,e){t.G=Date.now(),Cn(t),t.B=Rn(t.A);var n=t.B,r=t.W;Array.isArray(r)||(r=[String(r)]),Zn(n.i,"t",r),t.o=0,n=t.l.J,t.h=new yn,t.g=Zr(t.l,n?e:null,!t.u),0<t.O&&(t.M=new $e(Dt(t.Pa,t,t.g),t.O)),Ke(t.U,t.g,"readystatechange",t.nb),e=t.I?ae(t.I):{},t.u?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.B,t.v,t.u,e)):(t.v="GET",t.g.ha(t.B,t.v,null,e)),tn(),function(t,e,n,r,i,s){t.info((function(){if(t.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.v,t.B,t.m,t.W,t.u)}function Tn(t){return!!t.g&&"GET"==t.v&&2!=t.L&&t.l.Ha}function Sn(t,e,n){let r,i=!0;for(;!t.J&&t.o<n.length;){if(r=In(t,n),r==bn){4==e&&(t.s=4,nn(14),i=!1),We(t.j,t.m,null,"[Incomplete Response]");break}if(r==wn){t.s=4,nn(15),We(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}We(t.j,t.m,r,null),xn(t,r)}Tn(t)&&0!=t.o&&(t.h.g=t.h.g.slice(t.o),t.o=0),4!=e||0!=n.length||t.h.h||(t.s=1,nn(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.ba&&(t.ba=!0,(e=t.l).g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),Gr(e),e.M=!0,nn(11))):(We(t.j,t.m,n,"[Invalid Chunked Response]"),Nn(t),kn(t))}function In(t,e){var n=t.o,r=e.indexOf("\n",n);return-1==r?bn:(n=Number(e.substring(n,r)),isNaN(n)?wn:(r+=1)+n>e.length?bn:(e=e.slice(r,r+n),t.o=r+n,e))}function Cn(t){t.Y=Date.now()+t.P,Dn(t,t.P)}function Dn(t,e){if(null!=t.C)throw Error("WatchDog timer not null");t.C=sn(Dt(t.lb,t),e)}function An(t){t.C&&(bt.clearTimeout(t.C),t.C=null)}function kn(t){0==t.l.H||t.J||Qr(t.l,t)}function Nn(t){An(t);var e=t.M;e&&"function"==typeof e.sa&&e.sa(),t.M=null,Be(t.V),He(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function xn(t,e){try{var n=t.l;if(0!=n.H&&(n.g==t||or(n.i,t)))if(!t.K&&or(n.i,t)&&3==n.H){try{var r=n.Ja.g.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.G+3e3<t.G))break t;Hr(n),Fr(n)}zr(n),nn(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&0==n.A&&!n.v&&(n.v=sn(Dt(n.ib,n),6e3));if(1>=sr(n.i)&&n.oa){try{n.oa()}catch(t){}n.oa=void 0}}else Yr(n,11)}else if((t.K||n.g==t)&&Hr(n),!Pt(e))for(i=n.Ja.g.parse(e),e=0;e<i.length;e++){let u=i[e];if(n.V=u[0],u=u[1],2==n.H)if("c"==u[0]){n.K=u[1],n.pa=u[2];const e=u[3];null!=e&&(n.ra=e,n.l.info("VER="+n.ra));const i=u[4];null!=i&&(n.Ga=i,n.l.info("SVER="+n.Ga));const h=u[5];null!=h&&"number"==typeof h&&0<h&&(r=1.5*h,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var s=r.i;s.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(ar(s,s.h),s.h=null))}if(r.F){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.Da=t,Un(r.I,r.F,t))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=t;if((r=n).wa=Jr(r,r.J?r.pa:null,r.Y),o.K){cr(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.C&&(An(a),Cn(a)),r.g=o}else $r(r);0<n.j.length&&Ur(n)}else"stop"!=u[0]&&"close"!=u[0]||Yr(n,7);else 3==n.H&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?Yr(n,7):Pr(n):"noop"!=u[0]&&n.h&&n.h.Aa(u),n.A=0)}tn()}catch(t){}}function Mn(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(Et(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.ta&&"function"==typeof t.ta)return t.ta();if(!t.Z||"function"!=typeof t.Z){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(Et(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const r in t)e[n++]=r;return e}}}(t),r=function(t){if(t.Z&&"function"==typeof t.Z)return t.Z();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(Et(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],n&&n[s],t)}(mt=mn.prototype).setTimeout=function(t){this.P=t},mt.nb=function(t){t=t.target;const e=this.M;e&&3==Nr(t)?e.l():this.Pa(t)},mt.Pa=function(t){try{if(t==this.g)t:{const h=Nr(this.g);var e=this.g.Ia();if(this.g.da(),!(3>h)&&(3!=h||Kt||this.g&&(this.h.h||this.g.ja()||xr(this.g)))){this.J||4!=h||7==e||tn(),An(this);var n=this.g.da();this.ca=n;e:if(Tn(this)){var r=xr(this.g);t="";var i=r.length,s=4==Nr(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Nn(this),kn(this);var o="";break e}this.h.i=new bt.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=t,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(t,e,n,r,i,s,o){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+s+" "+o}))}(this.j,this.v,this.B,this.m,this.W,h,n),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Pt(a)){var u=a;break e}}u=null}if(!(n=u)){this.i=!1,this.s=3,nn(12),Nn(this),kn(this);break t}We(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,xn(this,n)}this.S?(Sn(this,h,o),Kt&&this.i&&3==h&&(Ke(this.U,this.V,"tick",this.mb),this.V.start())):(We(this.j,this.m,o,null),xn(this,o)),4==h&&Nn(this),this.i&&!this.J&&(4==h?Qr(this.l,this):(this.i=!1,Cn(this)))}else(function(t){const e={};t=(t.g&&2<=Nr(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<t.length;r++){if(Pt(t[r]))continue;var n=Me(t[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=e[i]||[];e[i]=s,s.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,nn(12)):(this.s=0,nn(13)),Nn(this),kn(this)}}}catch(t){}},mt.mb=function(){if(this.g){var t=Nr(this.g),e=this.g.ja();this.o<e.length&&(An(this),Sn(this,t,e),this.i&&4!=t&&Cn(this))}},mt.cancel=function(){this.J=!0,Nn(this)},mt.lb=function(){this.C=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.B),2!=this.L&&(tn(),nn(17)),Nn(this),this.s=2,kn(this)):Dn(this,this.Y-t)};var Ln=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function On(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof On){this.h=t.h,Pn(this,t.j),this.s=t.s,this.g=t.g,Fn(this,t.m),this.l=t.l;var e=t.i,n=new Wn;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),Vn(this,n),this.o=t.o}else t&&(e=String(t).match(Ln))?(this.h=!1,Pn(this,e[1]||"",!0),this.s=jn(e[2]||""),this.g=jn(e[3]||"",!0),Fn(this,e[4]),this.l=jn(e[5]||"",!0),Vn(this,e[6]||"",!0),this.o=jn(e[7]||"")):(this.h=!1,this.i=new Wn(null,this.h))}function Rn(t){return new On(t)}function Pn(t,e,n){t.j=n?jn(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Fn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Vn(t,e,n){e instanceof Wn?(t.i=e,function(t,e){e&&!t.j&&(Yn(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Xn(this,e),Zn(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=qn(e,Hn)),t.i=new Wn(e,t.h))}function Un(t,e,n){t.i.set(e,n)}function Bn(t){return Un(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function jn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function qn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,$n),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function $n(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}On.prototype.toString=function(){var t=[],e=this.j;e&&t.push(qn(e,zn,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(qn(e,zn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(qn(n,"/"==n.charAt(0)?Kn:Gn,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",qn(n,Qn)),t.join("")};var zn=/[#\/\?@]/g,Gn=/[#\?:]/g,Kn=/[#\?]/g,Hn=/[#\?@]/g,Qn=/#/g;function Wn(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Yn(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var s=t[n].substring(0,r);i=t[n].substring(r+1)}else s=t[n];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Xn(t,e){Yn(t),e=tr(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Jn(t,e){return Yn(t),e=tr(t,e),t.g.has(e)}function Zn(t,e,n){Xn(t,e),0<n.length&&(t.i=null,t.g.set(tr(t,e),Mt(n)),t.h+=n.length)}function tr(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(mt=Wn.prototype).add=function(t,e){Yn(this),this.i=null,t=tr(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},mt.forEach=function(t,e){Yn(this),this.g.forEach((function(n,r){n.forEach((function(n){t.call(e,n,r,this)}),this)}),this)},mt.ta=function(){Yn(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){const i=t[r];for(let t=0;t<i.length;t++)n.push(e[r])}return n},mt.Z=function(t){Yn(this);let e=[];if("string"==typeof t)Jn(this,t)&&(e=e.concat(this.g.get(tr(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},mt.set=function(t,e){return Yn(this),this.i=null,Jn(this,t=tr(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},mt.get=function(t,e){return t&&0<(t=this.Z(t)).length?String(t[0]):e},mt.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),t.push(i)}}return this.i=t.join("&")};var er=class{constructor(t,e){this.g=t,this.map=e}};function nr(t){this.l=t||rr,t=bt.PerformanceNavigationTiming?0<(t=bt.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(bt.g&&bt.g.Ka&&bt.g.Ka()&&bt.g.Ka().dc),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var rr=10;function ir(t){return!!t.h||!!t.g&&t.g.size>=t.j}function sr(t){return t.h?1:t.g?t.g.size:0}function or(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function ar(t,e){t.g?t.g.add(e):t.h=e}function cr(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function ur(t){if(null!=t.h)return t.i.concat(t.h.F);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}return Mt(t.i)}nr.prototype.cancel=function(){if(this.i=ur(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var hr=class{stringify(t){return bt.JSON.stringify(t,void 0)}parse(t){return bt.JSON.parse(t,void 0)}};function lr(){this.g=new hr}function dr(t,e,n){const r=n||"";try{Mn(t,(function(t,n){let i=t;_t(t)&&(i=Ae(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function fr(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}function gr(t){this.l=t.ec||null,this.j=t.ob||!1}function pr(t,e){Ie.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=mr,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}kt(gr,cn),gr.prototype.g=function(){return new pr(this.l,this.j)},gr.prototype.i=function(t){return function(){return t}}({}),kt(pr,Ie);var mr=0;function yr(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}function vr(t){t.readyState=4,t.l=null,t.j=null,t.A=null,wr(t)}function wr(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(mt=pr.prototype).open=function(t,e){if(this.readyState!=mr)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,wr(this)},mt.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||bt).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},mt.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,vr(this)),this.readyState=mr},mt.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,wr(this)),this.g&&(this.readyState=3,wr(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==bt.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;yr(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))},mt.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?vr(this):wr(this),3==this.readyState&&yr(this)}},mt.Za=function(t){this.g&&(this.response=this.responseText=t,vr(this))},mt.Ya=function(t){this.g&&(this.response=t,vr(this))},mt.ka=function(){this.g&&vr(this)},mt.setRequestHeader=function(t,e){this.v.append(t,e)},mt.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},mt.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(pr.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var br=bt.JSON.parse;function Er(t){Ie.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=_r,this.L=this.M=!1}kt(Er,Ie);var _r="",Tr=/^https?$/i,Sr=["POST","PUT"];function Ir(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Cr(t),Ar(t)}function Cr(t){t.F||(t.F=!0,Ce(t,"complete"),Ce(t,"error"))}function Dr(t){if(t.h&&void 0!==wt&&(!t.C[1]||4!=Nr(t)||2!=t.da()))if(t.v&&4==Nr(t))je(t.La,0,t);else if(Ce(t,"readystatechange"),4==Nr(t)){t.h=!1;try{const o=t.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var r;if(r=0===o){var i=String(t.I).match(Ln)[1]||null;!i&&bt.self&&bt.self.location&&(i=bt.self.location.protocol.slice(0,-1)),r=!Tr.test(i?i.toLowerCase():"")}n=r}if(n)Ce(t,"complete"),Ce(t,"success");else{t.m=6;try{var s=2<Nr(t)?t.g.statusText:""}catch(t){s=""}t.j=s+" ["+t.da()+"]",Cr(t)}}finally{Ar(t)}}}function Ar(t,e){if(t.g){kr(t);const n=t.g,r=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||Ce(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function kr(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(bt.clearTimeout(t.A),t.A=null)}function Nr(t){return t.g?t.g.readyState:0}function xr(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case _r:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Mr(t){let e="";return oe(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function Lr(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=Mr(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Un(t,e,n))}function Or(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Rr(t){this.Ga=0,this.j=[],this.l=new Qe,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Or("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Or("baseRetryDelayMs",5e3,t),this.hb=Or("retryDelaySeedMs",1e4,t),this.eb=Or("forwardChannelMaxRetries",2,t),this.xa=Or("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new nr(t&&t.concurrentRequestLimit),this.Ja=new lr,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Pr(t){if(Vr(t),3==t.H){var e=t.W++,n=Rn(t.I);if(Un(n,"SID",t.K),Un(n,"RID",e),Un(n,"TYPE","terminate"),jr(t,n),(e=new mn(t,t.l,e)).L=2,e.A=Bn(Rn(n)),n=!1,bt.navigator&&bt.navigator.sendBeacon)try{n=bt.navigator.sendBeacon(e.A.toString(),"")}catch(t){}!n&&bt.Image&&((new Image).src=e.A,n=!0),n||(e.g=Zr(e.l,null),e.g.ha(e.A)),e.G=Date.now(),Cn(e)}Xr(t)}function Fr(t){t.g&&(Gr(t),t.g.cancel(),t.g=null)}function Vr(t){Fr(t),t.u&&(bt.clearTimeout(t.u),t.u=null),Hr(t),t.i.cancel(),t.m&&("number"==typeof t.m&&bt.clearTimeout(t.m),t.m=null)}function Ur(t){if(!ir(t.i)&&!t.m){t.m=!0;var e=t.Na;Oe||Fe(),Re||(Oe(),Re=!0),Pe.add(e,t),t.C=0}}function Br(t,e){var n;n=e?e.m:t.W++;const r=Rn(t.I);Un(r,"SID",t.K),Un(r,"RID",n),Un(r,"AID",t.V),jr(t,r),t.o&&t.s&&Lr(r,t.o,t.s),n=new mn(t,t.l,n,t.C+1),null===t.o&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=qr(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),ar(t.i,n),En(n,r,e)}function jr(t,e){t.na&&oe(t.na,(function(t,n){Un(e,n,t)})),t.h&&Mn({},(function(t,n){Un(e,n,t)}))}function qr(t,e,n){n=Math.min(t.j.length,n);var r=t.h?Dt(t.h.Va,t.h,t):null;t:{var i=t.j;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=i[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let s=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=e,0>n)e=Math.max(0,i[o].g-100),s=!1;else try{dr(a,t,"req"+n+"_")}catch(t){r&&r(a)}}if(s){r=t.join("&");break t}}}return t=t.j.splice(0,n),e.F=t,r}function $r(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;Oe||Fe(),Re||(Oe(),Re=!0),Pe.add(e,t),t.A=0}}function zr(t){return!(t.g||t.u||3<=t.A||(t.ba++,t.u=sn(Dt(t.Ma,t),Wr(t,t.A)),t.A++,0))}function Gr(t){null!=t.B&&(bt.clearTimeout(t.B),t.B=null)}function Kr(t){t.g=new mn(t,t.l,"rpc",t.ba),null===t.o&&(t.g.I=t.s),t.g.O=0;var e=Rn(t.wa);Un(e,"RID","rpc"),Un(e,"SID",t.K),Un(e,"AID",t.V),Un(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&Un(e,"TO",t.qa),Un(e,"TYPE","xmlhttp"),jr(t,e),t.o&&t.s&&Lr(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.A=Bn(Rn(e)),n.u=null,n.S=!0,_n(n,t)}function Hr(t){null!=t.v&&(bt.clearTimeout(t.v),t.v=null)}function Qr(t,e){var n=null;if(t.g==e){Hr(t),Gr(t),t.g=null;var r=2}else{if(!or(t.i,e))return;n=e.F,cr(t.i,e),r=1}if(0!=t.H)if(e.i)if(1==r){n=e.u?e.u.length:0,e=Date.now()-e.G;var i=t.C;Ce(r=Je(),new rn(r,n)),Ur(t)}else $r(t);else if(3==(i=e.s)||0==i&&0<e.ca||!(1==r&&function(t,e){return!(sr(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.j=e.F.concat(t.j),0):1==t.H||2==t.H||t.C>=(t.cb?0:t.eb)||(t.m=sn(Dt(t.Na,t,e),Wr(t,t.C)),t.C++,0)))}(t,e)||2==r&&zr(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:Yr(t,5);break;case 4:Yr(t,10);break;case 3:Yr(t,6);break;default:Yr(t,2)}}function Wr(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function Yr(t,e){if(t.l.info("Error code "+e),2==e){var n=null;t.h&&(n=null);var r=Dt(t.pb,t);n||(n=new On("//www.google.com/images/cleardot.gif"),bt.location&&"http"==bt.location.protocol||Pn(n,"https"),Bn(n)),function(t,e){const n=new Qe;if(bt.Image){const r=new Image;r.onload=At(fr,n,r,"TestLoadImage: loaded",!0,e),r.onerror=At(fr,n,r,"TestLoadImage: error",!1,e),r.onabort=At(fr,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=At(fr,n,r,"TestLoadImage: timeout",!1,e),bt.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else nn(2);t.H=0,t.h&&t.h.za(e),Xr(t),Vr(t)}function Xr(t){if(t.H=0,t.ma=[],t.h){const e=ur(t.i);0==e.length&&0==t.j.length||(Lt(t.ma,e),Lt(t.ma,t.j),t.i.i.length=0,Mt(t.j),t.j.length=0),t.h.ya()}}function Jr(t,e,n){var r=n instanceof On?Rn(n):new On(n);if(""!=r.g)e&&(r.g=e+"."+r.g),Fn(r,r.m);else{var i=bt.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new On(null);r&&Pn(s,r),e&&(s.g=e),i&&Fn(s,i),n&&(s.l=n),r=s}return n=t.F,e=t.Da,n&&e&&Un(r,n,e),Un(r,"VER",t.ra),jr(t,r),r}function Zr(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Ha&&!t.va?new Er(new gr({ob:n})):new Er(t.va)).Oa(t.J),e}function ti(){}function ei(){if(zt&&!(10<=Number(Zt)))throw Error("Environmental error: no available transport.")}function ni(t,e){Ie.call(this),this.g=new Rr(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!Pt(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Pt(e)&&(this.g.F=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new si(this)}function ri(t){fn.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function ii(){gn.call(this),this.status=1}function si(t){this.g=t}function oi(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function ai(t,e,n){n||(n=0);var r=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],i=t.g[2];var s=t.g[3],o=e+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=n+(o<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=n+((o=e+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(e^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+i&4294967295,t.g[3]=t.g[3]+s&4294967295}function ci(t,e){this.h=e;for(var n=[],r=!0,i=t.length-1;0<=i;i--){var s=0|t[i];r&&s==e||(n[i]=s,r=!1)}this.g=n}(mt=Er.prototype).Oa=function(t){this.M=t},mt.ha=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():ln.g(),this.C=this.u?un(this.u):un(ln),this.g.onreadystatechange=Dt(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(t){return void Ir(this,t)}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const t of r.keys())n.set(t,r.get(t))}r=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),i=bt.FormData&&t instanceof bt.FormData,!(0<=xt(Sr,e))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{kr(this),0<this.B&&((this.L=function(t){return zt&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Dt(this.ua,this)):this.A=je(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){Ir(this,t)}},mt.ua=function(){void 0!==wt&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ce(this,"timeout"),this.abort(8))},mt.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Ce(this,"complete"),Ce(this,"abort"),Ar(this))},mt.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Ar(this,!0)),Er.$.N.call(this)},mt.La=function(){this.s||(this.G||this.v||this.l?Dr(this):this.kb())},mt.kb=function(){Dr(this)},mt.isActive=function(){return!!this.g},mt.da=function(){try{return 2<Nr(this)?this.g.status:-1}catch(t){return-1}},mt.ja=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},mt.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),br(e)}},mt.Ia=function(){return this.m},mt.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(mt=Rr.prototype).ra=8,mt.H=1,mt.Na=function(t){if(this.m)if(this.m=null,1==this.H){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const i=new mn(this,this.l,t);let s=this.s;if(this.U&&(s?(s=ae(s),ue(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)t:{for(var e=0,n=0;n<this.j.length;n++){var r=this.j[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=n;break t}if(4096===e||n===this.j.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=qr(this,i,e),Un(n=Rn(this.I),"RID",t),Un(n,"CVER",22),this.F&&Un(n,"X-HTTP-Session-Id",this.F),jr(this,n),s&&(this.O?e="headers="+encodeURIComponent(String(Mr(s)))+"&"+e:this.o&&Lr(n,this.o,s)),ar(this.i,i),this.bb&&Un(n,"TYPE","init"),this.P?(Un(n,"$req",e),Un(n,"SID","null"),i.aa=!0,En(i,n,null)):En(i,n,e),this.H=2}}else 3==this.H&&(t?Br(this,t):0==this.j.length||ir(this.i)||Br(this))},mt.Ma=function(){if(this.u=null,Kr(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=sn(Dt(this.jb,this),t)}},mt.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,nn(10),Fr(this),Kr(this))},mt.ib=function(){null!=this.v&&(this.v=null,Fr(this),zr(this),nn(19))},mt.pb=function(t){t?(this.l.info("Successfully pinged google.com"),nn(2)):(this.l.info("Failed to ping google.com"),nn(1))},mt.isActive=function(){return!!this.h&&this.h.isActive(this)},(mt=ti.prototype).Ba=function(){},mt.Aa=function(){},mt.za=function(){},mt.ya=function(){},mt.isActive=function(){return!0},mt.Va=function(){},ei.prototype.g=function(t,e){return new ni(t,e)},kt(ni,Ie),ni.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;nn(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=Jr(t,null,t.Y),Ur(t)},ni.prototype.close=function(){Pr(this.g)},ni.prototype.u=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=Ae(t),t=n);e.j.push(new er(e.fb++,t)),3==e.H&&Ur(e)},ni.prototype.N=function(){this.g.h=null,delete this.j,Pr(this.g),delete this.g,ni.$.N.call(this)},kt(ri,fn),kt(ii,gn),kt(si,ti),si.prototype.Ba=function(){Ce(this.g,"a")},si.prototype.Aa=function(t){Ce(this.g,new ri(t))},si.prototype.za=function(t){Ce(this.g,new ii)},si.prototype.ya=function(){Ce(this.g,"b")},kt(oi,(function(){this.blockSize=-1})),oi.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},oi.prototype.j=function(t,e){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(0==i)for(;s<=n;)ai(this,t,s),s+=this.blockSize;if("string"==typeof t){for(;s<e;)if(r[i++]=t.charCodeAt(s++),i==this.blockSize){ai(this,r),i=0;break}}else for(;s<e;)if(r[i++]=t[s++],i==this.blockSize){ai(this,r),i=0;break}}this.h=i,this.i+=e},oi.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var r=0;32>r;r+=8)t[n++]=this.g[e]>>>r&255;return t};var ui={};function hi(t){return-128<=t&&128>t?function(t,e){var n=ui;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=function(t){return new ci([0|t],0>t?-1:0)}(t)}(t):new ci([0|t],0>t?-1:0)}function li(t){if(isNaN(t)||!isFinite(t))return fi;if(0>t)return vi(li(-t));for(var e=[],n=1,r=0;t>=n;r++)e[r]=t/n|0,n*=di;return new ci(e,0)}var di=4294967296,fi=hi(0),gi=hi(1),pi=hi(16777216);function mi(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function yi(t){return-1==t.h}function vi(t){for(var e=t.g.length,n=[],r=0;r<e;r++)n[r]=~t.g[r];return new ci(n,~t.h).add(gi)}function wi(t,e){return t.add(vi(e))}function bi(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function Ei(t,e){this.g=t,this.h=e}function _i(t,e){if(mi(e))throw Error("division by zero");if(mi(t))return new Ei(fi,fi);if(yi(t))return e=_i(vi(t),e),new Ei(vi(e.g),vi(e.h));if(yi(e))return e=_i(t,vi(e)),new Ei(vi(e.g),e.h);if(30<t.g.length){if(yi(t)||yi(e))throw Error("slowDivide_ only works with positive integers.");for(var n=gi,r=e;0>=r.X(t);)n=Ti(n),r=Ti(r);var i=Si(n,1),s=Si(r,1);for(r=Si(r,2),n=Si(n,2);!mi(r);){var o=s.add(r);0>=o.X(t)&&(i=i.add(n),s=o),r=Si(r,1),n=Si(n,1)}return e=wi(t,i.R(e)),new Ei(i,e)}for(i=fi;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(s=li(n)).R(e);yi(o)||0<o.X(t);)o=(s=li(n-=r)).R(e);mi(s)&&(s=gi),i=i.add(s),t=wi(t,o)}return new Ei(i,t)}function Ti(t){for(var e=t.g.length+1,n=[],r=0;r<e;r++)n[r]=t.D(r)<<1|t.D(r-1)>>>31;return new ci(n,t.h)}function Si(t,e){var n=e>>5;e%=32;for(var r=t.g.length-n,i=[],s=0;s<r;s++)i[s]=0<e?t.D(s+n)>>>e|t.D(s+n+1)<<32-e:t.D(s+n);return new ci(i,t.h)}(mt=ci.prototype).ea=function(){if(yi(this))return-vi(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var r=this.D(n);t+=(0<=r?r:di+r)*e,e*=di}return t},mt.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(mi(this))return"0";if(yi(this))return"-"+vi(this).toString(t);for(var e=li(Math.pow(t,6)),n=this,r="";;){var i=_i(n,e).g,s=((0<(n=wi(n,i.R(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(mi(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},mt.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},mt.X=function(t){return yi(t=wi(this,t))?-1:mi(t)?0:1},mt.abs=function(){return yi(this)?vi(this):this},mt.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0,i=0;i<=e;i++){var s=r+(65535&this.D(i))+(65535&t.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(t.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new ci(n,-2147483648&n[n.length-1]?-1:0)},mt.R=function(t){if(mi(this)||mi(t))return fi;if(yi(this))return yi(t)?vi(this).R(vi(t)):vi(vi(this).R(t));if(yi(t))return vi(this.R(vi(t)));if(0>this.X(pi)&&0>t.X(pi))return li(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],r=0;r<2*e;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<t.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=t.D(i)>>>16,c=65535&t.D(i);n[2*r+2*i]+=o*c,bi(n,2*r+2*i),n[2*r+2*i+1]+=s*c,bi(n,2*r+2*i+1),n[2*r+2*i+1]+=o*a,bi(n,2*r+2*i+1),n[2*r+2*i+2]+=s*a,bi(n,2*r+2*i+2)}for(r=0;r<e;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=e;r<2*e;r++)n[r]=0;return new ci(n,0)},mt.gb=function(t){return _i(this,t).h},mt.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)&t.D(r);return new ci(n,this.h&t.h)},mt.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)|t.D(r);return new ci(n,this.h|t.h)},mt.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)^t.D(r);return new ci(n,this.h^t.h)},ei.prototype.createWebChannel=ei.prototype.g,ni.prototype.send=ni.prototype.u,ni.prototype.open=ni.prototype.m,ni.prototype.close=ni.prototype.close,on.NO_ERROR=0,on.TIMEOUT=8,on.HTTP_ERROR=6,an.COMPLETE="complete",hn.EventType=dn,dn.OPEN="a",dn.CLOSE="b",dn.ERROR="c",dn.MESSAGE="d",Ie.prototype.listen=Ie.prototype.O,Er.prototype.listenOnce=Er.prototype.P,Er.prototype.getLastError=Er.prototype.Sa,Er.prototype.getLastErrorCode=Er.prototype.Ia,Er.prototype.getStatus=Er.prototype.da,Er.prototype.getResponseJson=Er.prototype.Wa,Er.prototype.getResponseText=Er.prototype.ja,Er.prototype.send=Er.prototype.ha,Er.prototype.setWithCredentials=Er.prototype.Oa,oi.prototype.digest=oi.prototype.l,oi.prototype.reset=oi.prototype.reset,oi.prototype.update=oi.prototype.j,ci.prototype.add=ci.prototype.add,ci.prototype.multiply=ci.prototype.R,ci.prototype.modulo=ci.prototype.gb,ci.prototype.compare=ci.prototype.X,ci.prototype.toNumber=ci.prototype.ea,ci.prototype.toString=ci.prototype.toString,ci.prototype.getBits=ci.prototype.D,ci.fromNumber=li,ci.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return vi(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=li(Math.pow(n,8)),i=fi,s=0;s<e.length;s+=8){var o=Math.min(8,e.length-s),a=parseInt(e.substring(s,s+o),n);8>o?(o=li(Math.pow(n,o)),i=i.R(o).add(li(a))):i=(i=i.R(r)).add(li(a))}return i};var Ii=vt.createWebChannelTransport=function(){return new ei},Ci=vt.getStatEventTarget=function(){return Je()},Di=vt.ErrorCode=on,Ai=vt.EventType=an,ki=vt.Event=Ye,Ni=vt.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},xi=(vt.FetchXmlHttpFactory=gr,vt.WebChannel=hn),Mi=vt.XhrIo=Er,Li=vt.Md5=oi,Oi=vt.Integer=ci;const Ri="@firebase/firestore";class Pi{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Pi.UNAUTHENTICATED=new Pi(null),Pi.GOOGLE_CREDENTIALS=new Pi("google-credentials-uid"),Pi.FIRST_PARTY=new Pi("first-party-uid"),Pi.MOCK_USER=new Pi("mock-user");let Fi="10.10.0";const Vi=new C("@firebase/firestore");function Ui(){return Vi.logLevel}function Bi(t,...e){if(Vi.logLevel<=E.DEBUG){const n=e.map($i);Vi.debug(`Firestore (${Fi}): ${t}`,...n)}}function ji(t,...e){if(Vi.logLevel<=E.ERROR){const n=e.map($i);Vi.error(`Firestore (${Fi}): ${t}`,...n)}}function qi(t,...e){if(Vi.logLevel<=E.WARN){const n=e.map($i);Vi.warn(`Firestore (${Fi}): ${t}`,...n)}}function $i(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function zi(t="Unexpected state"){const e=`FIRESTORE (${Fi}) INTERNAL ASSERTION FAILED: `+t;throw ji(e),new Error(e)}function Gi(t,e){t||zi()}function Ki(t,e){return t}const Hi={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Qi extends h{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Wi{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Yi{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Xi{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Pi.UNAUTHENTICATED)))}shutdown(){}}class Ji{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class Zi{constructor(t){this.t=t,this.currentUser=Pi.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let i=new Wi;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Wi,t.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const e=i;t.enqueueRetryable((async()=>{await e.promise,await r(this.currentUser)}))},o=t=>{Bi("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(Bi("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Wi)}}),0),s()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(Bi("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Gi("string"==typeof e.accessToken),new Yi(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return Gi(null===t||"string"==typeof t),new Pi(t)}}class ts{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=Pi.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class es{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new ts(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable((()=>e(Pi.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class ns{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class rs{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){const n=t=>{null!=t.error&&Bi("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.R;return this.R=t.token,Bi("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const r=t=>{Bi("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.A.onInit((t=>r(t))),setTimeout((()=>{if(!this.appCheck){const t=this.A.getImmediate({optional:!0});t?r(t):Bi("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(Gi("string"==typeof t.token),this.R=t.token,new ns(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function is(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class ss{static newId(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=is(40);for(let r=0;r<n.length;++r)e.length<20&&n[r]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return e}}function os(t,e){return t<e?-1:t>e?1:0}function as(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}class cs{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Qi(Hi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Qi(Hi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Qi(Hi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Qi(Hi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return cs.fromMillis(Date.now())}static fromDate(t){return cs.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new cs(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?os(this.nanoseconds,t.nanoseconds):os(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class us{constructor(t){this.timestamp=t}static fromTimestamp(t){return new us(t)}static min(){return new us(new cs(0,0))}static max(){return new us(new cs(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class hs{constructor(t,e,n){void 0===e?e=0:e>t.length&&zi(),void 0===n?n=t.length-e:n>t.length-e&&zi(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===hs.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof hs?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),i=e.get(r);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class ls extends hs{construct(t,e,n){return new ls(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Qi(Hi.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new ls(e)}static emptyPath(){return new ls([])}}const ds=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class fs extends hs{construct(t,e,n){return new fs(t,e,n)}static isValidIdentifier(t){return ds.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),fs.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new fs(["__name__"])}static fromServerFormat(t){const e=[];let n="",r=0;const i=()=>{if(0===n.length)throw new Qi(Hi.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let s=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new Qi(Hi.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Qi(Hi.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(s=!s,r++):"."!==e||s?(n+=e,r++):(i(),r++)}if(i(),s)throw new Qi(Hi.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new fs(e)}static emptyPath(){return new fs([])}}class gs{constructor(t){this.path=t}static fromPath(t){return new gs(ls.fromString(t))}static fromName(t){return new gs(ls.fromString(t).popFirst(5))}static empty(){return new gs(ls.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===ls.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return ls.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new gs(new ls(t.slice()))}}function ps(t){return new ms(t.readTime,t.key,-1)}class ms{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new ms(us.min(),gs.empty(),-1)}static max(){return new ms(us.max(),gs.empty(),-1)}}function ys(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=gs.comparator(t.documentKey,e.documentKey),0!==n?n:os(t.largestBatchId,e.largestBatchId))}const vs="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ws{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function bs(t){if(t.code!==Hi.FAILED_PRECONDITION||t.message!==vs)throw t;Bi("LocalStore","Unexpectedly lost primary lease")}class Es{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&zi(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Es(((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof Es?e:Es.resolve(e)}catch(t){return Es.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):Es.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):Es.reject(e)}static resolve(t){return new Es(((e,n)=>{e(t)}))}static reject(t){return new Es(((e,n)=>{n(t)}))}static waitFor(t){return new Es(((e,n)=>{let r=0,i=0,s=!1;t.forEach((t=>{++r,t.next((()=>{++i,s&&i===r&&e()}),(t=>n(t)))})),s=!0,i===r&&e()}))}static or(t){let e=Es.resolve(!1);for(const n of t)e=e.next((t=>t?Es.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,r)=>{n.push(e.call(this,t,r))})),this.waitFor(n)}static mapArray(t,e){return new Es(((n,r)=>{const i=t.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;e(t[c]).next((t=>{s[c]=t,++o,o===i&&n(s)}),(t=>r(t)))}}))}static doWhile(t,e){return new Es(((n,r)=>{const i=()=>{!0===t()?e().next((()=>{i()}),r):n()};i()}))}}class _s{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.V=new Wi,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{e.error?this.V.reject(new Is(t,e.error)):this.V.resolve()},this.transaction.onerror=e=>{const n=Ns(e.target.error);this.V.reject(new Is(t,n))}}static open(t,e,n,r){try{return new _s(e,t.transaction(r,n))}catch(t){throw new Is(e,t)}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(Bi("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const t=this.transaction;this.aborted||"function"!=typeof t.commit||t.commit()}store(t){const e=this.transaction.objectStore(t);return new Ds(e)}}class Ts{constructor(t,e,n){this.name=t,this.version=e,this.p=n,12.2===Ts.S(c())&&ji("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return Bi("SimpleDb","Removing database:",t),As(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!u())return!1;if(Ts.C())return!0;const t=c(),e=Ts.S(t),n=0<e&&e<10,r=Ts.v(t),i=0<r&&r<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||i)}static C(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.__PRIVATE_env)||void 0===t?void 0:t.F)}static M(t,e){return t.store(e)}static S(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static v(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async O(t){return this.db||(Bi("SimpleDb","Opening database:",this.name),this.db=await new Promise(((e,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=t=>{const n=t.target.result;e(n)},r.onblocked=()=>{n(new Is(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=e=>{const r=e.target.error;"VersionError"===r.name?n(new Qi(Hi.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new Qi(Hi.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new Is(t,r))},r.onupgradeneeded=t=>{Bi("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.p.N(e,r.transaction,t.oldVersion,this.version).next((()=>{Bi("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.L&&(this.db.onversionchange=t=>this.L(t)),this.db}B(t){this.L=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,r){const i="readonly"===e;let s=0;for(;;){++s;try{this.db=await this.O(t);const e=_s.open(this.db,t,i?"readonly":"readwrite",n),s=r(e).next((t=>(e.g(),t))).catch((t=>(e.abort(t),Es.reject(t)))).toPromise();return s.catch((()=>{})),await e.m,s}catch(t){const e=t,n="FirebaseError"!==e.name&&s<3;if(Bi("SimpleDb","Transaction failed with error:",e.message,"Retrying:",n),this.close(),!n)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Ss{constructor(t){this.k=t,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(t){this.k=t}done(){this.q=!0}U(t){this.K=t}delete(){return As(this.k.delete())}}class Is extends Qi{constructor(t,e){super(Hi.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function Cs(t){return"IndexedDbTransactionError"===t.name}class Ds{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(Bi("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Bi("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),As(n)}add(t){return Bi("SimpleDb","ADD",this.store.name,t,t),As(this.store.add(t))}get(t){return As(this.store.get(t)).next((e=>(void 0===e&&(e=null),Bi("SimpleDb","GET",this.store.name,t,e),e)))}delete(t){return Bi("SimpleDb","DELETE",this.store.name,t),As(this.store.delete(t))}count(){return Bi("SimpleDb","COUNT",this.store.name),As(this.store.count())}W(t,e){const n=this.options(t,e),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){const t=r.getAll(n.range);return new Es(((e,n)=>{t.onerror=t=>{n(t.target.error)},t.onsuccess=t=>{e(t.target.result)}}))}{const t=this.cursor(n),e=[];return this.G(t,((t,n)=>{e.push(n)})).next((()=>e))}}j(t,e){const n=this.store.getAll(t,null===e?void 0:e);return new Es(((t,e)=>{n.onerror=t=>{e(t.target.error)},n.onsuccess=e=>{t(e.target.result)}}))}H(t,e){Bi("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.J=!1;const r=this.cursor(n);return this.G(r,((t,e,n)=>n.delete()))}Y(t,e){let n;e?n=t:(n={},e=t);const r=this.cursor(n);return this.G(r,e)}Z(t){const e=this.cursor({});return new Es(((n,r)=>{e.onerror=t=>{const e=Ns(t.target.error);r(e)},e.onsuccess=e=>{const r=e.target.result;r?t(r.primaryKey,r.value).next((t=>{t?r.continue():n()})):n()}}))}G(t,e){const n=[];return new Es(((r,i)=>{t.onerror=t=>{i(t.target.error)},t.onsuccess=t=>{const i=t.target.result;if(!i)return void r();const s=new Ss(i),o=e(i.primaryKey,i.value,s);if(o instanceof Es){const t=o.catch((t=>(s.done(),Es.reject(t))));n.push(t)}s.isDone?r():null===s.$?i.continue():i.continue(s.$)}})).next((()=>Es.waitFor(n)))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.J?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function As(t){return new Es(((e,n)=>{t.onsuccess=t=>{const n=t.target.result;e(n)},t.onerror=t=>{const e=Ns(t.target.error);n(e)}}))}let ks=!1;function Ns(t){const e=Ts.S(c());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new Qi("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ks||(ks=!0,setTimeout((()=>{throw t}),0)),t}}return t}class xs{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.se(t),this.oe=t=>e.writeSequenceNumber(t))}se(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.oe&&this.oe(t),t}}function Ms(t){return null==t}function Ls(t){return 0===t&&1/t==-1/0}xs._e=-1;function Os(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Rs(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Ps(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class Fs{constructor(t,e){this.comparator=t,this.root=e||Us.EMPTY}insert(t,e){return new Fs(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Us.BLACK,null,null))}remove(t){return new Fs(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Us.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Vs(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Vs(this.root,t,this.comparator,!1)}getReverseIterator(){return new Vs(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Vs(this.root,t,this.comparator,!0)}}class Vs{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Us{constructor(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Us.RED,this.left=null!=r?r:Us.EMPTY,this.right=null!=i?i:Us.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,i){return new Us(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const i=n(t,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Us.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return Us.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Us.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Us.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw zi();if(this.right.isRed())throw zi();const t=this.left.check();if(t!==this.right.check())throw zi();return t+(this.isRed()?0:1)}}Us.EMPTY=null,Us.RED=!0,Us.BLACK=!1,Us.EMPTY=new class{constructor(){this.size=0}get key(){throw zi()}get value(){throw zi()}get color(){throw zi()}get left(){throw zi()}get right(){throw zi()}copy(t,e,n,r,i){return this}insert(t,e,n){return new Us(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Bs{constructor(t){this.comparator=t,this.data=new Fs(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new js(this.data.getIterator())}getIteratorFrom(t){return new js(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof Bs))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Bs(this.comparator);return e.data=t,e}}class js{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class qs{constructor(t){this.fields=t,t.sort(fs.comparator)}static empty(){return new qs([])}unionWith(t){let e=new Bs(fs.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new qs(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return as(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class $s extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class zs{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new $s("Invalid base64 string: "+t):t}}(t);return new zs(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new zs(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return os(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}zs.EMPTY_BYTE_STRING=new zs("");const Gs=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ks(t){if(Gi(!!t),"string"==typeof t){let e=0;const n=Gs.exec(t);if(Gi(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Hs(t.seconds),nanos:Hs(t.nanos)}}function Hs(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Qs(t){return"string"==typeof t?zs.fromBase64String(t):zs.fromUint8Array(t)}function Ws(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Ys(t){const e=t.mapValue.fields.__previous_value__;return Ws(e)?Ys(e):e}function Xs(t){const e=Ks(t.mapValue.fields.__local_write_time__.timestampValue);return new cs(e.seconds,e.nanos)}class Js{constructor(t,e,n,r,i,s,o,a,c){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class Zs{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new Zs("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof Zs&&t.projectId===this.projectId&&t.database===this.database}}const to={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function eo(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ws(t)?4:mo(t)?9007199254740991:10:zi()}function no(t,e){if(t===e)return!0;const n=eo(t);if(n!==eo(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Xs(t).isEqual(Xs(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Ks(t.timestampValue),r=Ks(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Qs(t.bytesValue).isEqual(Qs(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Hs(t.geoPointValue.latitude)===Hs(e.geoPointValue.latitude)&&Hs(t.geoPointValue.longitude)===Hs(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Hs(t.integerValue)===Hs(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Hs(t.doubleValue),r=Hs(e.doubleValue);return n===r?Ls(n)===Ls(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return as(t.arrayValue.values||[],e.arrayValue.values||[],no);case 10:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Os(n)!==Os(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!no(n[t],r[t])))return!1;return!0}(t,e);default:return zi()}}function ro(t,e){return void 0!==(t.values||[]).find((t=>no(t,e)))}function io(t,e){if(t===e)return 0;const n=eo(t),r=eo(e);if(n!==r)return os(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return os(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Hs(t.integerValue||t.doubleValue),r=Hs(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return so(t.timestampValue,e.timestampValue);case 4:return so(Xs(t),Xs(e));case 5:return os(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Qs(t),r=Qs(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=os(n[t],r[t]);if(0!==e)return e}return os(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=os(Hs(t.latitude),Hs(e.latitude));return 0!==n?n:os(Hs(t.longitude),Hs(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=io(n[t],r[t]);if(e)return e}return os(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===to.mapValue&&e===to.mapValue)return 0;if(t===to.mapValue)return 1;if(e===to.mapValue)return-1;const n=t.fields||{},r=Object.keys(n),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let t=0;t<r.length&&t<s.length;++t){const e=os(r[t],s[t]);if(0!==e)return e;const o=io(n[r[t]],i[s[t]]);if(0!==o)return o}return os(r.length,s.length)}(t.mapValue,e.mapValue);default:throw zi()}}function so(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return os(t,e);const n=Ks(t),r=Ks(e),i=os(n.seconds,r.seconds);return 0!==i?i:os(n.nanos,r.nanos)}function oo(t){return ao(t)}function ao(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=Ks(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return Qs(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return gs.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return`geo(${t.latitude},${t.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=ao(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const i of e)r?r=!1:n+=",",n+=`${i}:${ao(t.fields[i])}`;return n+"}"}(t.mapValue):zi()}function co(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function uo(t){return!!t&&"integerValue"in t}function ho(t){return!!t&&"arrayValue"in t}function lo(t){return!!t&&"nullValue"in t}function fo(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function go(t){return!!t&&"mapValue"in t}function po(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Rs(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=po(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=po(t.arrayValue.values[n]);return e}return Object.assign({},t)}function mo(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class yo{constructor(t){this.value=t}static empty(){return new yo({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!go(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=po(e)}setAll(t){let e=fs.emptyPath(),n={},r=[];t.forEach(((t,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=i.popLast()}t?n[i.lastSegment()]=po(t):r.push(i.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,r)}delete(t){const e=this.field(t.popLast());go(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return no(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];go(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){Rs(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new yo(po(this.value))}}function vo(t){const e=[];return Rs(t.fields,((t,n)=>{const r=new fs([t]);if(go(n)){const t=vo(n.mapValue).fields;if(0===t.length)e.push(r);else for(const n of t)e.push(r.child(n))}else e.push(r)})),new qs(e)}class wo{constructor(t,e,n,r,i,s,o){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(t){return new wo(t,0,us.min(),us.min(),us.min(),yo.empty(),0)}static newFoundDocument(t,e,n,r){return new wo(t,1,e,us.min(),n,r,0)}static newNoDocument(t,e){return new wo(t,2,e,us.min(),us.min(),yo.empty(),0)}static newUnknownDocument(t,e){return new wo(t,3,e,us.min(),us.min(),yo.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(us.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=yo.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=yo.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=us.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof wo&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new wo(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class bo{constructor(t,e){this.position=t,this.inclusive=e}}function Eo(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const s=e[i],o=t.position[i];if(r=s.field.isKeyField()?gs.comparator(gs.fromName(o.referenceValue),n.key):io(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function _o(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!no(t.position[n],e.position[n]))return!1;return!0}class To{constructor(t,e="asc"){this.field=t,this.dir=e}}function So(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class Io{}class Co extends Io{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new Lo(t,e,n):"array-contains"===e?new Fo(t,n):"in"===e?new Vo(t,n):"not-in"===e?new Uo(t,n):"array-contains-any"===e?new Bo(t,n):new Co(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new Oo(t,n):new Ro(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(io(e,this.value)):null!==e&&eo(this.value)===eo(e)&&this.matchesComparison(io(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return zi()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Do extends Io{constructor(t,e){super(),this.filters=t,this.op=e,this.ue=null}static create(t,e){return new Do(t,e)}matches(t){return Ao(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function Ao(t){return"and"===t.op}function ko(t){return function(t){for(const e of t.filters)if(e instanceof Do)return!1;return!0}(t)&&Ao(t)}function No(t){if(t instanceof Co)return t.field.canonicalString()+t.op.toString()+oo(t.value);if(ko(t))return t.filters.map((t=>No(t))).join(",");{const e=t.filters.map((t=>No(t))).join(",");return`${t.op}(${e})`}}function xo(t,e){return t instanceof Co?function(t,e){return e instanceof Co&&t.op===e.op&&t.field.isEqual(e.field)&&no(t.value,e.value)}(t,e):t instanceof Do?function(t,e){return e instanceof Do&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,r)=>t&&xo(n,e.filters[r])),!0)}(t,e):void zi()}function Mo(t){return t instanceof Co?function(t){return`${t.field.canonicalString()} ${t.op} ${oo(t.value)}`}(t):t instanceof Do?function(t){return t.op.toString()+" {"+t.getFilters().map(Mo).join(" ,")+"}"}(t):"Filter"}class Lo extends Co{constructor(t,e,n){super(t,e,n),this.key=gs.fromName(n.referenceValue)}matches(t){const e=gs.comparator(t.key,this.key);return this.matchesComparison(e)}}class Oo extends Co{constructor(t,e){super(t,"in",e),this.keys=Po(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Ro extends Co{constructor(t,e){super(t,"not-in",e),this.keys=Po(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function Po(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>gs.fromName(t.referenceValue)))}class Fo extends Co{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return ho(e)&&ro(e.arrayValue,this.value)}}class Vo extends Co{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&ro(this.value.arrayValue,e)}}class Uo extends Co{constructor(t,e){super(t,"not-in",e)}matches(t){if(ro(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!ro(this.value.arrayValue,e)}}class Bo extends Co{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!ho(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>ro(this.value.arrayValue,t)))}}class jo{constructor(t,e=null,n=[],r=[],i=null,s=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.ce=null}}function qo(t,e=null,n=[],r=[],i=null,s=null,o=null){return new jo(t,e,n,r,i,s,o)}function $o(t){const e=Ki(t);if(null===e.ce){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>No(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),Ms(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>oo(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>oo(t))).join(",")),e.ce=t}return e.ce}function zo(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!So(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!xo(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!_o(t.startAt,e.startAt)&&_o(t.endAt,e.endAt)}function Go(t){return gs.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Ko{constructor(t,e=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function Ho(t){return new Ko(t)}function Qo(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function Wo(t){return null!==t.collectionGroup}function Yo(t){const e=Ki(t);if(null===e.le){e.le=[];const t=new Set;for(const n of e.explicitOrderBy)e.le.push(n),t.add(n.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",r=function(t){let e=new Bs(fs.comparator);return t.filters.forEach((t=>{t.getFlattenedFilters().forEach((t=>{t.isInequality()&&(e=e.add(t.field))}))})),e}(e);r.forEach((r=>{t.has(r.canonicalString())||r.isKeyField()||e.le.push(new To(r,n))})),t.has(fs.keyField().canonicalString())||e.le.push(new To(fs.keyField(),n))}return e.le}function Xo(t){const e=Ki(t);return e.he||(e.he=function(t,e){if("F"===t.limitType)return qo(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((t=>{const e="desc"===t.dir?"asc":"desc";return new To(t.field,e)}));const n=t.endAt?new bo(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new bo(t.startAt.position,t.startAt.inclusive):null;return qo(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}(e,Yo(t))),e.he}function Jo(t,e){const n=t.filters.concat([e]);return new Ko(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Zo(t,e,n){return new Ko(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function ta(t,e){return zo(Xo(t),Xo(e))&&t.limitType===e.limitType}function ea(t){return`${$o(Xo(t))}|lt:${t.limitType}`}function na(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>Mo(t))).join(", ")}]`),Ms(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>oo(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>oo(t))).join(",")),`Target(${e})`}(Xo(t))}; limitType=${t.limitType})`}function ra(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):gs.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of Yo(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const r=Eo(t,e,n);return t.inclusive?r<=0:r<0}(t.startAt,Yo(t),e)||t.endAt&&!function(t,e,n){const r=Eo(t,e,n);return t.inclusive?r>=0:r>0}(t.endAt,Yo(t),e))}(t,e)}function ia(t){return(e,n)=>{let r=!1;for(const i of Yo(t)){const t=sa(i,e,n);if(0!==t)return t;r=r||i.field.isKeyField()}return 0}}function sa(t,e,n){const r=t.field.isKeyField()?gs.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?io(r,i):zi()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return zi()}}class oa{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,r]of n)if(this.equalsFn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(t){Rs(this.inner,((e,n)=>{for(const[e,r]of n)t(e,r)}))}isEmpty(){return Ps(this.inner)}size(){return this.innerSize}}const aa=new Fs(gs.comparator);function ca(){return aa}const ua=new Fs(gs.comparator);function ha(...t){let e=ua;for(const n of t)e=e.insert(n.key,n);return e}function la(t){let e=ua;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function da(){return ga()}function fa(){return ga()}function ga(){return new oa((t=>t.toString()),((t,e)=>t.isEqual(e)))}const pa=new Fs(gs.comparator),ma=new Bs(gs.comparator);function ya(...t){let e=ma;for(const n of t)e=e.add(n);return e}const va=new Bs(os);function wa(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ls(e)?"-0":e}}function ba(t){return{integerValue:""+t}}function Ea(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!Ls(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?ba(e):wa(t,e)}class _a{constructor(){this._=void 0}}function Ta(t,e,n){return t instanceof Ca?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&Ws(e)&&(e=Ys(e)),e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Da?Aa(t,e):t instanceof ka?Na(t,e):function(t,e){const n=Ia(t,e),r=Ma(n)+Ma(t.Ie);return uo(n)&&uo(t.Ie)?ba(r):wa(t.serializer,r)}(t,e)}function Sa(t,e,n){return t instanceof Da?Aa(t,e):t instanceof ka?Na(t,e):n}function Ia(t,e){return t instanceof xa?function(t){return uo(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}class Ca extends _a{}class Da extends _a{constructor(t){super(),this.elements=t}}function Aa(t,e){const n=La(e);for(const e of t.elements)n.some((t=>no(t,e)))||n.push(e);return{arrayValue:{values:n}}}class ka extends _a{constructor(t){super(),this.elements=t}}function Na(t,e){let n=La(e);for(const e of t.elements)n=n.filter((t=>!no(t,e)));return{arrayValue:{values:n}}}class xa extends _a{constructor(t,e){super(),this.serializer=t,this.Ie=e}}function Ma(t){return Hs(t.integerValue||t.doubleValue)}function La(t){return ho(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Oa{constructor(t,e){this.version=t,this.transformResults=e}}class Ra{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Ra}static exists(t){return new Ra(void 0,t)}static updateTime(t){return new Ra(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Pa(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Fa{}function Va(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Qa(t.key,Ra.none()):new $a(t.key,t.data,Ra.none());{const n=t.data,r=yo.empty();let i=new Bs(fs.comparator);for(let t of e.fields)if(!i.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?r.delete(t):r.set(t,e),i=i.add(t)}return new za(t.key,r,new qs(i.toArray()),Ra.none())}}function Ua(t,e,n){t instanceof $a?function(t,e,n){const r=t.value.clone(),i=Ka(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof za?function(t,e,n){if(!Pa(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=Ka(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Ga(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Ba(t,e,n,r){return t instanceof $a?function(t,e,n,r){if(!Pa(t.precondition,e))return n;const i=t.value.clone(),s=Ha(t.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}(t,e,n,r):t instanceof za?function(t,e,n,r){if(!Pa(t.precondition,e))return n;const i=Ha(t.fieldTransforms,r,e),s=e.data;return s.setAll(Ga(t)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,r):function(t,e,n){return Pa(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function ja(t,e){let n=null;for(const r of t.fieldTransforms){const t=e.data.field(r.field),i=Ia(r.transform,t||null);null!=i&&(null===n&&(n=yo.empty()),n.set(r.field,i))}return n||null}function qa(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&as(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Da&&e instanceof Da||t instanceof ka&&e instanceof ka?as(t.elements,e.elements,no):t instanceof xa&&e instanceof xa?no(t.Ie,e.Ie):t instanceof Ca&&e instanceof Ca}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class $a extends Fa{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class za extends Fa{constructor(t,e,n,r,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Ga(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function Ka(t,e,n){const r=new Map;Gi(t.length===n.length);for(let i=0;i<n.length;i++){const s=t[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,Sa(o,a,n[i]))}return r}function Ha(t,e,n){const r=new Map;for(const i of t){const t=i.transform,s=n.data.field(i.field);r.set(i.field,Ta(t,s,e))}return r}class Qa extends Fa{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Wa extends Fa{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Ya{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&Ua(r,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Ba(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Ba(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=fa();return this.mutations.forEach((r=>{const i=t.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=e.has(r.key)?null:o;const a=Va(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(us.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),ya())}isEqual(t){return this.batchId===t.batchId&&as(this.mutations,t.mutations,((t,e)=>qa(t,e)))&&as(this.baseMutations,t.baseMutations,((t,e)=>qa(t,e)))}}class Xa{constructor(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}static from(t,e,n){Gi(t.mutations.length===n.length);let r=pa;const i=t.mutations;for(let t=0;t<i.length;t++)r=r.insert(i[t].key,n[t].version);return new Xa(t,e,n,r)}}class Ja{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Za{constructor(t,e){this.count=t,this.unchangedNames=e}}var tc,ec;function nc(t){if(void 0===t)return ji("GRPC error has no .code"),Hi.UNKNOWN;switch(t){case tc.OK:return Hi.OK;case tc.CANCELLED:return Hi.CANCELLED;case tc.UNKNOWN:return Hi.UNKNOWN;case tc.DEADLINE_EXCEEDED:return Hi.DEADLINE_EXCEEDED;case tc.RESOURCE_EXHAUSTED:return Hi.RESOURCE_EXHAUSTED;case tc.INTERNAL:return Hi.INTERNAL;case tc.UNAVAILABLE:return Hi.UNAVAILABLE;case tc.UNAUTHENTICATED:return Hi.UNAUTHENTICATED;case tc.INVALID_ARGUMENT:return Hi.INVALID_ARGUMENT;case tc.NOT_FOUND:return Hi.NOT_FOUND;case tc.ALREADY_EXISTS:return Hi.ALREADY_EXISTS;case tc.PERMISSION_DENIED:return Hi.PERMISSION_DENIED;case tc.FAILED_PRECONDITION:return Hi.FAILED_PRECONDITION;case tc.ABORTED:return Hi.ABORTED;case tc.OUT_OF_RANGE:return Hi.OUT_OF_RANGE;case tc.UNIMPLEMENTED:return Hi.UNIMPLEMENTED;case tc.DATA_LOSS:return Hi.DATA_LOSS;default:return zi()}}(ec=tc||(tc={}))[ec.OK=0]="OK",ec[ec.CANCELLED=1]="CANCELLED",ec[ec.UNKNOWN=2]="UNKNOWN",ec[ec.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ec[ec.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ec[ec.NOT_FOUND=5]="NOT_FOUND",ec[ec.ALREADY_EXISTS=6]="ALREADY_EXISTS",ec[ec.PERMISSION_DENIED=7]="PERMISSION_DENIED",ec[ec.UNAUTHENTICATED=16]="UNAUTHENTICATED",ec[ec.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ec[ec.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ec[ec.ABORTED=10]="ABORTED",ec[ec.OUT_OF_RANGE=11]="OUT_OF_RANGE",ec[ec.UNIMPLEMENTED=12]="UNIMPLEMENTED",ec[ec.INTERNAL=13]="INTERNAL",ec[ec.UNAVAILABLE=14]="UNAVAILABLE",ec[ec.DATA_LOSS=15]="DATA_LOSS";const rc=new Oi([4294967295,4294967295],0);function ic(t){const e=(new TextEncoder).encode(t),n=new Li;return n.update(e),new Uint8Array(n.digest())}function sc(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Oi([n,r],0),new Oi([i,s],0)]}class oc{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new ac(`Invalid padding: ${e}`);if(n<0)throw new ac(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new ac(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new ac(`Invalid padding when bitmap length is 0: ${e}`);this.Te=8*t.length-e,this.Ee=Oi.fromNumber(this.Te)}de(t,e,n){let r=t.add(e.multiply(Oi.fromNumber(n)));return 1===r.compare(rc)&&(r=new Oi([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ee).toNumber()}Ae(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.Te)return!1;const e=ic(t),[n,r]=sc(e);for(let t=0;t<this.hashCount;t++){const e=this.de(n,r,t);if(!this.Ae(e))return!1}return!0}static create(t,e,n){const r=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),s=new oc(i,r,e);return n.forEach((t=>s.insert(t))),s}insert(t){if(0===this.Te)return;const e=ic(t),[n,r]=sc(e);for(let t=0;t<this.hashCount;t++){const e=this.de(n,r,t);this.Re(e)}}Re(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class ac extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class cc{constructor(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const r=new Map;return r.set(t,uc.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new cc(us.min(),r,new Fs(os),ca(),ya())}}class uc{constructor(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new uc(n,e,ya(),ya(),ya())}}class hc{constructor(t,e,n,r){this.Ve=t,this.removedTargetIds=e,this.key=n,this.me=r}}class lc{constructor(t,e){this.targetId=t,this.fe=e}}class dc{constructor(t,e,n=zs.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class fc{constructor(){this.ge=0,this.pe=mc(),this.ye=zs.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(t){t.approximateByteSize()>0&&(this.Se=!0,this.ye=t)}ve(){let t=ya(),e=ya(),n=ya();return this.pe.forEach(((r,i)=>{switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:zi()}})),new uc(this.ye,this.we,t,e,n)}Fe(){this.Se=!1,this.pe=mc()}Me(t,e){this.Se=!0,this.pe=this.pe.insert(t,e)}xe(t){this.Se=!0,this.pe=this.pe.remove(t)}Oe(){this.ge+=1}Ne(){this.ge-=1,Gi(this.ge>=0)}Le(){this.Se=!0,this.we=!0}}class gc{constructor(t){this.Be=t,this.ke=new Map,this.qe=ca(),this.Qe=pc(),this.Ke=new Fs(os)}$e(t){for(const e of t.Ve)t.me&&t.me.isFoundDocument()?this.Ue(e,t.me):this.We(e,t.key,t.me);for(const e of t.removedTargetIds)this.We(e,t.key,t.me)}Ge(t){this.forEachTarget(t,(e=>{const n=this.ze(e);switch(t.state){case 0:this.je(e)&&n.Ce(t.resumeToken);break;case 1:n.Ne(),n.be||n.Fe(),n.Ce(t.resumeToken);break;case 2:n.Ne(),n.be||this.removeTarget(e);break;case 3:this.je(e)&&(n.Le(),n.Ce(t.resumeToken));break;case 4:this.je(e)&&(this.He(e),n.Ce(t.resumeToken));break;default:zi()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ke.forEach(((t,n)=>{this.je(n)&&e(n)}))}Je(t){const e=t.targetId,n=t.fe.count,r=this.Ye(e);if(r){const i=r.target;if(Go(i))if(0===n){const t=new gs(i.path);this.We(e,t,wo.newNoDocument(t,us.min()))}else Gi(1===n);else{const r=this.Ze(e);if(r!==n){const n=this.Xe(t),i=n?this.et(n,t,r):1;if(0!==i){this.He(e);const t=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(e,t)}}}}}Xe(t){const e=t.fe.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=e;let s,o;try{s=Qs(n).toUint8Array()}catch(t){if(t instanceof $s)return qi("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw t}try{o=new oc(s,r,i)}catch(t){return qi(t instanceof ac?"BloomFilter error: ":"Applying bloom filter failed: ",t),null}return 0===o.Te?null:o}et(t,e,n){return e.fe.count===n-this.rt(t,e.targetId)?0:2}rt(t,e){const n=this.Be.getRemoteKeysForTarget(e);let r=0;return n.forEach((n=>{const i=this.Be.nt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;t.mightContain(s)||(this.We(e,n,null),r++)})),r}it(t){const e=new Map;this.ke.forEach(((n,r)=>{const i=this.Ye(r);if(i){if(n.current&&Go(i.target)){const e=new gs(i.target.path);null!==this.qe.get(e)||this.st(r,e)||this.We(r,e,wo.newNoDocument(e,t))}n.De&&(e.set(r,n.ve()),n.Fe())}}));let n=ya();this.Qe.forEach(((t,e)=>{let r=!0;e.forEachWhile((t=>{const e=this.Ye(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(r=!1,!1)})),r&&(n=n.add(t))})),this.qe.forEach(((e,n)=>n.setReadTime(t)));const r=new cc(t,e,this.Ke,this.qe,n);return this.qe=ca(),this.Qe=pc(),this.Ke=new Fs(os),r}Ue(t,e){if(!this.je(t))return;const n=this.st(t,e.key)?2:0;this.ze(t).Me(e.key,n),this.qe=this.qe.insert(e.key,e),this.Qe=this.Qe.insert(e.key,this.ot(e.key).add(t))}We(t,e,n){if(!this.je(t))return;const r=this.ze(t);this.st(t,e)?r.Me(e,1):r.xe(e),this.Qe=this.Qe.insert(e,this.ot(e).delete(t)),n&&(this.qe=this.qe.insert(e,n))}removeTarget(t){this.ke.delete(t)}Ze(t){const e=this.ze(t).ve();return this.Be.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Oe(t){this.ze(t).Oe()}ze(t){let e=this.ke.get(t);return e||(e=new fc,this.ke.set(t,e)),e}ot(t){let e=this.Qe.get(t);return e||(e=new Bs(os),this.Qe=this.Qe.insert(t,e)),e}je(t){const e=null!==this.Ye(t);return e||Bi("WatchChangeAggregator","Detected inactive target",t),e}Ye(t){const e=this.ke.get(t);return e&&e.be?null:this.Be._t(t)}He(t){this.ke.set(t,new fc),this.Be.getRemoteKeysForTarget(t).forEach((e=>{this.We(t,e,null)}))}st(t,e){return this.Be.getRemoteKeysForTarget(t).has(e)}}function pc(){return new Fs(gs.comparator)}function mc(){return new Fs(gs.comparator)}const yc={asc:"ASCENDING",desc:"DESCENDING"},vc={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},wc={and:"AND",or:"OR"};class bc{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function Ec(t,e){return t.useProto3Json||Ms(e)?e:{value:e}}function _c(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Tc(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function Sc(t,e){return _c(t,e.toTimestamp())}function Ic(t){return Gi(!!t),us.fromTimestamp(function(t){const e=Ks(t);return new cs(e.seconds,e.nanos)}(t))}function Cc(t,e){return Dc(t,e).canonicalString()}function Dc(t,e){const n=function(t){return new ls(["projects",t.projectId,"databases",t.database])}(t).child("documents");return void 0===e?n:n.child(e)}function Ac(t){const e=ls.fromString(t);return Gi(Kc(e)),e}function kc(t,e){return Cc(t.databaseId,e.path)}function Nc(t,e){const n=Ac(e);if(n.get(1)!==t.databaseId.projectId)throw new Qi(Hi.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Qi(Hi.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new gs(Lc(n))}function xc(t,e){return Cc(t.databaseId,e)}function Mc(t){return new ls(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Lc(t){return Gi(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Oc(t,e,n){return{name:kc(t,e),fields:n.value.mapValue.fields}}function Rc(t,e){return{documents:[xc(t,e.path)]}}function Pc(t,e){const n={structuredQuery:{}},r=e.path;let i;null!==e.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=xc(t,i);const s=function(t){if(0!==t.length)return zc(Do.create(t,"and"))}(e.filters);s&&(n.structuredQuery.where=s);const o=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:qc(t.field),direction:Uc(t.dir)}}(t)))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=Ec(t,e.limit);return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),{ut:n,parent:i}}function Fc(t){let e=function(t){const e=Ac(t);return 4===e.length?ls.emptyPath():Lc(e)}(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Gi(1===r);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let s=[];n.where&&(s=function(t){const e=Vc(t);return e instanceof Do&&ko(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map((t=>function(t){return new To($c(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Ms(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new bo(n,e)}(n.startAt));let u=null;return n.endAt&&(u=function(t){const e=!t.before,n=t.values||[];return new bo(n,e)}(n.endAt)),function(t,e,n,r,i,s,o,a){return new Ko(t,e,n,r,i,s,o,a)}(e,i,o,s,a,"F",c,u)}function Vc(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=$c(t.unaryFilter.field);return Co.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=$c(t.unaryFilter.field);return Co.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=$c(t.unaryFilter.field);return Co.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=$c(t.unaryFilter.field);return Co.create(i,"!=",{nullValue:"NULL_VALUE"});default:return zi()}}(t):void 0!==t.fieldFilter?function(t){return Co.create($c(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return zi()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return Do.create(t.compositeFilter.filters.map((t=>Vc(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return zi()}}(t.compositeFilter.op))}(t):zi()}function Uc(t){return yc[t]}function Bc(t){return vc[t]}function jc(t){return wc[t]}function qc(t){return{fieldPath:t.canonicalString()}}function $c(t){return fs.fromServerFormat(t.fieldPath)}function zc(t){return t instanceof Co?function(t){if("=="===t.op){if(fo(t.value))return{unaryFilter:{field:qc(t.field),op:"IS_NAN"}};if(lo(t.value))return{unaryFilter:{field:qc(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(fo(t.value))return{unaryFilter:{field:qc(t.field),op:"IS_NOT_NAN"}};if(lo(t.value))return{unaryFilter:{field:qc(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:qc(t.field),op:Bc(t.op),value:t.value}}}(t):t instanceof Do?function(t){const e=t.getFilters().map((t=>zc(t)));return 1===e.length?e[0]:{compositeFilter:{op:jc(t.op),filters:e}}}(t):zi()}function Gc(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Kc(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Hc{constructor(t,e,n,r,i=us.min(),s=us.min(),o=zs.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new Hc(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Hc(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Hc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Hc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Qc{constructor(t){this.ct=t}}function Wc(t){const e=Fc({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Zo(e,e.limit,"L"):e}class Yc{constructor(){}Pt(t,e){this.It(t,e),e.Tt()}It(t,e){if("nullValue"in t)this.Et(e,5);else if("booleanValue"in t)this.Et(e,10),e.dt(t.booleanValue?1:0);else if("integerValue"in t)this.Et(e,15),e.dt(Hs(t.integerValue));else if("doubleValue"in t){const n=Hs(t.doubleValue);isNaN(n)?this.Et(e,13):(this.Et(e,15),Ls(n)?e.dt(0):e.dt(n))}else if("timestampValue"in t){const n=t.timestampValue;this.Et(e,20),"string"==typeof n?e.At(n):(e.At(`${n.seconds||""}`),e.dt(n.nanos||0))}else if("stringValue"in t)this.Rt(t.stringValue,e),this.Vt(e);else if("bytesValue"in t)this.Et(e,30),e.ft(Qs(t.bytesValue)),this.Vt(e);else if("referenceValue"in t)this.gt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Et(e,45),e.dt(n.latitude||0),e.dt(n.longitude||0)}else"mapValue"in t?mo(t)?this.Et(e,Number.MAX_SAFE_INTEGER):(this.yt(t.mapValue,e),this.Vt(e)):"arrayValue"in t?(this.wt(t.arrayValue,e),this.Vt(e)):zi()}Rt(t,e){this.Et(e,25),this.St(t,e)}St(t,e){e.At(t)}yt(t,e){const n=t.fields||{};this.Et(e,55);for(const t of Object.keys(n))this.Rt(t,e),this.It(n[t],e)}wt(t,e){const n=t.values||[];this.Et(e,50);for(const t of n)this.It(t,e)}gt(t,e){this.Et(e,37),gs.fromName(t).path.forEach((t=>{this.Et(e,60),this.St(t,e)}))}Et(t,e){t.dt(e)}Vt(t){t.dt(2)}}Yc.bt=new Yc;class Xc{constructor(){this._n=new Jc}addToCollectionParentIndex(t,e){return this._n.add(e),Es.resolve()}getCollectionParents(t,e){return Es.resolve(this._n.getEntries(e))}addFieldIndex(t,e){return Es.resolve()}deleteFieldIndex(t,e){return Es.resolve()}deleteAllFieldIndexes(t){return Es.resolve()}createTargetIndexes(t,e){return Es.resolve()}getDocumentsMatchingTarget(t,e){return Es.resolve(null)}getIndexType(t,e){return Es.resolve(0)}getFieldIndexes(t,e){return Es.resolve([])}getNextCollectionGroupToUpdate(t){return Es.resolve(null)}getMinOffset(t,e){return Es.resolve(ms.min())}getMinOffsetFromCollectionGroup(t,e){return Es.resolve(ms.min())}updateCollectionGroup(t,e,n){return Es.resolve()}updateIndexEntries(t,e){return Es.resolve()}}class Jc{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Bs(ls.comparator),i=!r.has(n);return this.index[e]=r.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new Bs(ls.comparator)).toArray()}}new Uint8Array(0);class Zc{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new Zc(t,Zc.DEFAULT_COLLECTION_PERCENTILE,Zc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Zc.DEFAULT_COLLECTION_PERCENTILE=10,Zc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Zc.DEFAULT=new Zc(41943040,Zc.DEFAULT_COLLECTION_PERCENTILE,Zc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Zc.DISABLED=new Zc(-1,0,0);class tu{constructor(t){this.On=t}next(){return this.On+=2,this.On}static Nn(){return new tu(0)}static Ln(){return new tu(-1)}}class eu{constructor(){this.changes=new oa((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,wo.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?Es.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class nu{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class ru{constructor(t,e,n,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((r=>(n=r,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&Ba(n.mutation,t,qs.empty(),cs.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,ya()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=ya()){const r=da();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,n).next((t=>{let e=ha();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=da();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,ya())))}populateOverlays(t,e,n){const r=[];return n.forEach((t=>{e.has(t)||r.push(t)})),this.documentOverlayCache.getOverlays(t,r).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,r){let i=ca();const s=ga(),o=ga();return e.forEach(((t,e)=>{const o=n.get(e.key);r.has(e.key)&&(void 0===o||o.mutation instanceof za)?i=i.insert(e.key,e):void 0!==o?(s.set(e.key,o.mutation.getFieldMask()),Ba(o.mutation,e,o.mutation.getFieldMask(),cs.now())):s.set(e.key,qs.empty())})),this.recalculateAndSaveOverlays(t,i).next((t=>(t.forEach(((t,e)=>s.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new nu(e,null!==(n=s.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=ga();let r=new Fs(((t,e)=>t-e)),i=ya();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const i of t)i.keys().forEach((t=>{const s=e.get(t);if(null===s)return;let o=n.get(t)||qs.empty();o=i.applyToLocalView(s,o),n.set(t,o);const a=(r.get(i.batchId)||ya()).add(t);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=fa();c.forEach((t=>{if(!i.has(t)){const r=Va(e.get(t),n.get(t));null!==r&&u.set(t,r),i=i.add(t)}})),s.push(this.documentOverlayCache.saveOverlays(t,a,u))}return Es.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n,r){return function(t){return gs.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Wo(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,r):this.getDocumentsMatchingCollectionQuery(t,e,n,r)}getNextDocuments(t,e,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-i.size):Es.resolve(da());let o=-1,a=i;return s.next((e=>Es.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(e)?Es.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,i))).next((()=>this.computeViews(t,a,e,ya()))).next((t=>({batchId:o,changes:la(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new gs(e)).next((t=>{let e=ha();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n,r){const i=e.collectionGroup;let s=ha();return this.indexManager.getCollectionParents(t,i).next((o=>Es.forEach(o,(o=>{const a=function(t,e){return new Ko(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,o.child(i));return this.getDocumentsMatchingCollectionQuery(t,a,n,r).next((t=>{t.forEach(((t,e)=>{s=s.insert(t,e)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(t,e,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i,r)))).next((t=>{i.forEach(((e,n)=>{const r=n.getKey();null===t.get(r)&&(t=t.insert(r,wo.newInvalidDocument(r)))}));let n=ha();return t.forEach(((t,r)=>{const s=i.get(t);void 0!==s&&Ba(s.mutation,r,qs.empty(),cs.now()),ra(e,r)&&(n=n.insert(t,r))})),n}))}}class iu{constructor(t){this.serializer=t,this.cr=new Map,this.lr=new Map}getBundleMetadata(t,e){return Es.resolve(this.cr.get(e))}saveBundleMetadata(t,e){return this.cr.set(e.id,function(t){return{id:t.id,version:t.version,createTime:Ic(t.createTime)}}(e)),Es.resolve()}getNamedQuery(t,e){return Es.resolve(this.lr.get(e))}saveNamedQuery(t,e){return this.lr.set(e.name,function(t){return{name:t.name,query:Wc(t.bundledQuery),readTime:Ic(t.readTime)}}(e)),Es.resolve()}}class su{constructor(){this.overlays=new Fs(gs.comparator),this.hr=new Map}getOverlay(t,e){return Es.resolve(this.overlays.get(e))}getOverlays(t,e){const n=da();return Es.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,r)=>{this.ht(t,e,r)})),Es.resolve()}removeOverlaysForBatchId(t,e,n){const r=this.hr.get(n);return void 0!==r&&(r.forEach((t=>this.overlays=this.overlays.remove(t))),this.hr.delete(n)),Es.resolve()}getOverlaysForCollection(t,e,n){const r=da(),i=e.length+1,s=new gs(e.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const t=o.getNext().value,s=t.getKey();if(!e.isPrefixOf(s.path))break;s.path.length===i&&t.largestBatchId>n&&r.set(t.getKey(),t)}return Es.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let i=new Fs(((t,e)=>t-e));const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=da(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=da(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=r)););return Es.resolve(o)}ht(t,e,n){const r=this.overlays.get(n.key);if(null!==r){const t=this.hr.get(r.largestBatchId).delete(n.key);this.hr.set(r.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Ja(e,n));let i=this.hr.get(e);void 0===i&&(i=ya(),this.hr.set(e,i)),this.hr.set(e,i.add(n.key))}}class ou{constructor(){this.Pr=new Bs(au.Ir),this.Tr=new Bs(au.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(t,e){const n=new au(t,e);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.Ar(new au(t,e))}Rr(t,e){t.forEach((t=>this.removeReference(t,e)))}Vr(t){const e=new gs(new ls([])),n=new au(e,t),r=new au(e,t+1),i=[];return this.Tr.forEachInRange([n,r],(t=>{this.Ar(t),i.push(t.key)})),i}mr(){this.Pr.forEach((t=>this.Ar(t)))}Ar(t){this.Pr=this.Pr.delete(t),this.Tr=this.Tr.delete(t)}gr(t){const e=new gs(new ls([])),n=new au(e,t),r=new au(e,t+1);let i=ya();return this.Tr.forEachInRange([n,r],(t=>{i=i.add(t.key)})),i}containsKey(t){const e=new au(t,0),n=this.Pr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class au{constructor(t,e){this.key=t,this.pr=e}static Ir(t,e){return gs.comparator(t.key,e.key)||os(t.pr,e.pr)}static Er(t,e){return os(t.pr,e.pr)||gs.comparator(t.key,e.key)}}class cu{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.yr=1,this.wr=new Bs(au.Ir)}checkEmpty(t){return Es.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,r){const i=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Ya(i,e,n,r);this.mutationQueue.push(s);for(const e of r)this.wr=this.wr.add(new au(e.key,i)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return Es.resolve(s)}lookupMutationBatch(t,e){return Es.resolve(this.Sr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.br(n),i=r<0?0:r;return Es.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Es.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(t){return Es.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new au(e,0),r=new au(e,Number.POSITIVE_INFINITY),i=[];return this.wr.forEachInRange([n,r],(t=>{const e=this.Sr(t.pr);i.push(e)})),Es.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Bs(os);return e.forEach((t=>{const e=new au(t,0),r=new au(t,Number.POSITIVE_INFINITY);this.wr.forEachInRange([e,r],(t=>{n=n.add(t.pr)}))})),Es.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let i=n;gs.isDocumentKey(i)||(i=i.child(""));const s=new au(new gs(i),0);let o=new Bs(os);return this.wr.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.pr)),!0)}),s),Es.resolve(this.Dr(o))}Dr(t){const e=[];return t.forEach((t=>{const n=this.Sr(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){Gi(0===this.Cr(e.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return Es.forEach(e.mutations,(r=>{const i=new au(r.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.wr=n}))}Mn(t){}containsKey(t,e){const n=new au(e,0),r=this.wr.firstAfterOrEqual(n);return Es.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,Es.resolve()}Cr(t,e){return this.br(t)}br(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Sr(t){const e=this.br(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class uu{constructor(t){this.vr=t,this.docs=new Fs(gs.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,r=this.docs.get(n),i=r?r.size:0,s=this.vr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return Es.resolve(n?n.document.mutableCopy():wo.newInvalidDocument(e))}getEntries(t,e){let n=ca();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():wo.newInvalidDocument(t))})),Es.resolve(n)}getDocumentsMatchingQuery(t,e,n,r){let i=ca();const s=e.path,o=new gs(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!s.isPrefixOf(t.path))break;t.path.length>s.length+1||ys(ps(o),n)<=0||(r.has(o.key)||ra(e,o))&&(i=i.insert(o.key,o.mutableCopy()))}return Es.resolve(i)}getAllFromCollectionGroup(t,e,n,r){zi()}Fr(t,e){return Es.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new hu(this)}getSize(t){return Es.resolve(this.size)}}class hu extends eu{constructor(t){super(),this.ar=t}applyChanges(t){const e=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?e.push(this.ar.addEntry(t,r)):this.ar.removeEntry(n)})),Es.waitFor(e)}getFromCache(t,e){return this.ar.getEntry(t,e)}getAllFromCache(t,e){return this.ar.getEntries(t,e)}}class lu{constructor(t){this.persistence=t,this.Mr=new oa((t=>$o(t)),zo),this.lastRemoteSnapshotVersion=us.min(),this.highestTargetId=0,this.Or=0,this.Nr=new ou,this.targetCount=0,this.Lr=tu.Nn()}forEachTarget(t,e){return this.Mr.forEach(((t,n)=>e(n))),Es.resolve()}getLastRemoteSnapshotVersion(t){return Es.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Es.resolve(this.Or)}allocateTargetId(t){return this.highestTargetId=this.Lr.next(),Es.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Or&&(this.Or=e),Es.resolve()}qn(t){this.Mr.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Lr=new tu(e),this.highestTargetId=e),t.sequenceNumber>this.Or&&(this.Or=t.sequenceNumber)}addTargetData(t,e){return this.qn(e),this.targetCount+=1,Es.resolve()}updateTargetData(t,e){return this.qn(e),Es.resolve()}removeTargetData(t,e){return this.Mr.delete(e.target),this.Nr.Vr(e.targetId),this.targetCount-=1,Es.resolve()}removeTargets(t,e,n){let r=0;const i=[];return this.Mr.forEach(((s,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Mr.delete(s),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)})),Es.waitFor(i).next((()=>r))}getTargetCount(t){return Es.resolve(this.targetCount)}getTargetData(t,e){const n=this.Mr.get(e)||null;return Es.resolve(n)}addMatchingKeys(t,e,n){return this.Nr.dr(e,n),Es.resolve()}removeMatchingKeys(t,e,n){this.Nr.Rr(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((e=>{i.push(r.markPotentiallyOrphaned(t,e))})),Es.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.Nr.Vr(e),Es.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Nr.gr(e);return Es.resolve(n)}containsKey(t,e){return Es.resolve(this.Nr.containsKey(e))}}class du{constructor(t,e){this.Br={},this.overlays={},this.kr=new xs(0),this.qr=!1,this.qr=!0,this.referenceDelegate=t(this),this.Qr=new lu(this),this.indexManager=new Xc,this.remoteDocumentCache=function(t){return new uu(t)}((t=>this.referenceDelegate.Kr(t))),this.serializer=new Qc(e),this.$r=new iu(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new su,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Br[t.toKey()];return n||(n=new cu(e,this.referenceDelegate),this.Br[t.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(t,e,n){Bi("MemoryPersistence","Starting transaction:",t);const r=new fu(this.kr.next());return this.referenceDelegate.Ur(),n(r).next((t=>this.referenceDelegate.Wr(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Gr(t,e){return Es.or(Object.values(this.Br).map((n=>()=>n.containsKey(t,e))))}}class fu extends ws{constructor(t){super(),this.currentSequenceNumber=t}}class gu{constructor(t){this.persistence=t,this.zr=new ou,this.jr=null}static Hr(t){return new gu(t)}get Jr(){if(this.jr)return this.jr;throw zi()}addReference(t,e,n){return this.zr.addReference(n,e),this.Jr.delete(n.toString()),Es.resolve()}removeReference(t,e,n){return this.zr.removeReference(n,e),this.Jr.add(n.toString()),Es.resolve()}markPotentiallyOrphaned(t,e){return this.Jr.add(e.toString()),Es.resolve()}removeTarget(t,e){this.zr.Vr(e.targetId).forEach((t=>this.Jr.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Jr.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Ur(){this.jr=new Set}Wr(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Es.forEach(this.Jr,(n=>{const r=gs.fromPath(n);return this.Yr(t,r).next((t=>{t||e.removeEntry(r,us.min())}))})).next((()=>(this.jr=null,e.apply(t))))}updateLimboDocument(t,e){return this.Yr(t,e).next((t=>{t?this.Jr.delete(e.toString()):this.Jr.add(e.toString())}))}Kr(t){return 0}Yr(t,e){return Es.or([()=>Es.resolve(this.zr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Gr(t,e)])}}class pu{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.qi=n,this.Qi=r}static Ki(t,e){let n=ya(),r=ya();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new pu(t,e.fromCache,n,r)}}class mu{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class yu{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=!function(){var e;const n=null===(e=s())||void 0===e?void 0:e.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(t.g.process)}catch(t){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:Ts.v(c())>0?6:4}initialize(t,e){this.zi=t,this.indexManager=e,this.$i=!0}getDocumentsMatchingQuery(t,e,n,r){const i={result:null};return this.ji(t,e).next((t=>{i.result=t})).next((()=>{if(!i.result)return this.Hi(t,e,r,n).next((t=>{i.result=t}))})).next((()=>{if(i.result)return;const n=new mu;return this.Ji(t,e,n).next((r=>{if(i.result=r,this.Ui)return this.Yi(t,e,n,r.size)}))})).next((()=>i.result))}Yi(t,e,n,r){return n.documentReadCount<this.Wi?(Ui()<=E.DEBUG&&Bi("QueryEngine","SDK will not create cache indexes for query:",na(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),Es.resolve()):(Ui()<=E.DEBUG&&Bi("QueryEngine","Query:",na(e),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Gi*r?(Ui()<=E.DEBUG&&Bi("QueryEngine","The SDK decides to create cache indexes for query:",na(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Xo(e))):Es.resolve())}ji(t,e){if(Qo(e))return Es.resolve(null);let n=Xo(e);return this.indexManager.getIndexType(t,n).next((r=>0===r?null:(null!==e.limit&&1===r&&(e=Zo(e,null,"F"),n=Xo(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((r=>{const i=ya(...r);return this.zi.getDocuments(t,i).next((r=>this.indexManager.getMinOffset(t,n).next((n=>{const s=this.Zi(e,r);return this.Xi(e,s,i,n.readTime)?this.ji(t,Zo(e,null,"F")):this.es(t,s,e,n)}))))})))))}Hi(t,e,n,r){return Qo(e)||r.isEqual(us.min())?Es.resolve(null):this.zi.getDocuments(t,n).next((i=>{const s=this.Zi(e,i);return this.Xi(e,s,n,r)?Es.resolve(null):(Ui()<=E.DEBUG&&Bi("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),na(e)),this.es(t,s,e,function(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=us.fromTimestamp(1e9===r?new cs(n+1,0):new cs(n,r));return new ms(i,gs.empty(),e)}(r,-1)).next((t=>t)))}))}Zi(t,e){let n=new Bs(ia(t));return e.forEach(((e,r)=>{ra(t,r)&&(n=n.add(r))})),n}Xi(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const i="F"===t.limitType?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ji(t,e,n){return Ui()<=E.DEBUG&&Bi("QueryEngine","Using full collection scan to execute query:",na(e)),this.zi.getDocumentsMatchingQuery(t,e,ms.min(),n)}es(t,e,n,r){return this.zi.getDocumentsMatchingQuery(t,n,r).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class vu{constructor(t,e,n,r){this.persistence=t,this.ts=e,this.serializer=r,this.ns=new Fs(os),this.rs=new oa((t=>$o(t)),zo),this.ss=new Map,this.os=t.getRemoteDocumentCache(),this.Qr=t.getTargetCache(),this.$r=t.getBundleCache(),this._s(n)}_s(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new ru(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.ns)))}}async function wu(t,e){const n=Ki(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return n.mutationQueue.getAllMutationBatches(t).next((i=>(r=i,n._s(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const i=[],s=[];let o=ya();for(const t of r){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({us:t,removedBatchIds:i,addedBatchIds:s})))}))}))}function bu(t){const e=Ki(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Qr.getLastRemoteSnapshotVersion(t)))}function Eu(t,e){const n=Ki(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}async function _u(t,e,n){const r=Ki(t),i=r.ns.get(e),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(t=>r.persistence.referenceDelegate.removeTarget(t,i)))}catch(t){if(!Cs(t))throw t;Bi("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}r.ns=r.ns.remove(e),r.rs.delete(i.target)}function Tu(t,e,n){const r=Ki(t);let i=us.min(),s=ya();return r.persistence.runTransaction("Execute query","readwrite",(t=>function(t,e,n){const r=Ki(t),i=r.rs.get(n);return void 0!==i?Es.resolve(r.ns.get(i)):r.Qr.getTargetData(e,n)}(r,t,Xo(e)).next((e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(t,e.targetId).next((t=>{s=t}))})).next((()=>r.ts.getDocumentsMatchingQuery(t,e,n?i:us.min(),n?s:ya()))).next((t=>(function(t,e,n){let r=t.ss.get(e)||us.min();n.forEach(((t,e)=>{e.readTime.compareTo(r)>0&&(r=e.readTime)})),t.ss.set(e,r)}(r,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,hs:s})))))}class Su{constructor(){this.activeTargetIds=va}As(t){this.activeTargetIds=this.activeTargetIds.add(t)}Rs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ds(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Iu{constructor(){this.no=new Su,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.no.As(t),this.ro[t]||"not-current"}updateQueryState(t,e,n){this.ro[t]=e}removeLocalQueryTarget(t){this.no.Rs(t)}isLocalQueryTarget(t){return this.no.activeTargetIds.has(t)}clearQueryState(t){delete this.ro[t]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(t){return this.no.activeTargetIds.has(t)}start(){return this.no=new Su,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class Cu{io(t){}shutdown(){}}class Du{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(t){this.uo.push(t)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){Bi("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.uo)t(0)}ao(){Bi("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.uo)t(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Au=null;function ku(){return null===Au?Au=268435456+Math.round(2147483648*Math.random()):Au++,"0x"+Au.toString(16)}const Nu={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class xu{constructor(t){this.lo=t.lo,this.ho=t.ho}Po(t){this.Io=t}To(t){this.Eo=t}onMessage(t){this.Ao=t}close(){this.ho()}send(t){this.lo(t)}Ro(){this.Io()}Vo(t){this.Eo(t)}mo(t){this.Ao(t)}}const Mu="WebChannelConnection";class Lu extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.fo=e+"://"+t.host,this.po=`projects/${n}/databases/${r}`,this.yo="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get wo(){return!1}So(t,e,n,r,i){const s=ku(),o=this.bo(t,e.toUriEncodedString());Bi("RestConnection",`Sending RPC '${t}' ${s}:`,o,n);const a={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(a,r,i),this.Co(t,o,a,n).then((e=>(Bi("RestConnection",`Received RPC '${t}' ${s}: `,e),e)),(e=>{throw qi("RestConnection",`RPC '${t}' ${s} failed with error: `,e,"url: ",o,"request:",n),e}))}vo(t,e,n,r,i,s){return this.So(t,e,n,r,i)}Do(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+Fi,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}bo(t,e){const n=Nu[t];return`${this.fo}/v1/${e}:${n}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Co(t,e,n,r){const i=ku();return new Promise(((s,o)=>{const a=new Mi;a.setWithCredentials(!0),a.listenOnce(Ai.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case Di.NO_ERROR:const e=a.getResponseJson();Bi(Mu,`XHR for RPC '${t}' ${i} received:`,JSON.stringify(e)),s(e);break;case Di.TIMEOUT:Bi(Mu,`RPC '${t}' ${i} timed out`),o(new Qi(Hi.DEADLINE_EXCEEDED,"Request time out"));break;case Di.HTTP_ERROR:const n=a.getStatus();if(Bi(Mu,`RPC '${t}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Hi).indexOf(e)>=0?e:Hi.UNKNOWN}(e.status);o(new Qi(t,e.message))}else o(new Qi(Hi.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Qi(Hi.UNAVAILABLE,"Connection failed."));break;default:zi()}}finally{Bi(Mu,`RPC '${t}' ${i} completed.`)}}));const c=JSON.stringify(r);Bi(Mu,`RPC '${t}' ${i} sending request:`,r),a.send(e,"POST",c,n,15)}))}Fo(t,e,n){const r=ku(),i=[this.fo,"/","google.firestore.v1.Firestore","/",t,"/channel"],s=Ii(),o=Ci(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Do(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const u=i.join("");Bi(Mu,`Creating RPC '${t}' stream ${r}: ${u}`,a);const h=s.createWebChannel(u,a);let l=!1,d=!1;const f=new xu({lo:e=>{d?Bi(Mu,`Not sending because RPC '${t}' stream ${r} is closed:`,e):(l||(Bi(Mu,`Opening RPC '${t}' stream ${r} transport.`),h.open(),l=!0),Bi(Mu,`RPC '${t}' stream ${r} sending:`,e),h.send(e))},ho:()=>h.close()}),g=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return g(h,xi.EventType.OPEN,(()=>{d||Bi(Mu,`RPC '${t}' stream ${r} transport opened.`)})),g(h,xi.EventType.CLOSE,(()=>{d||(d=!0,Bi(Mu,`RPC '${t}' stream ${r} transport closed`),f.Vo())})),g(h,xi.EventType.ERROR,(e=>{d||(d=!0,qi(Mu,`RPC '${t}' stream ${r} transport errored:`,e),f.Vo(new Qi(Hi.UNAVAILABLE,"The operation could not be completed")))})),g(h,xi.EventType.MESSAGE,(e=>{var n;if(!d){const i=e.data[0];Gi(!!i);const s=i,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){Bi(Mu,`RPC '${t}' stream ${r} received error:`,o);const e=o.status;let n=function(t){const e=tc[t];if(void 0!==e)return nc(e)}(e),i=o.message;void 0===n&&(n=Hi.INTERNAL,i="Unknown error status: "+e+" with message "+o.message),d=!0,f.Vo(new Qi(n,i)),h.close()}else Bi(Mu,`RPC '${t}' stream ${r} received:`,i),f.mo(i)}})),g(o,ki.STAT_EVENT,(e=>{e.stat===Ni.PROXY?Bi(Mu,`RPC '${t}' stream ${r} detected buffering proxy`):e.stat===Ni.NOPROXY&&Bi(Mu,`RPC '${t}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.Ro()}),0),f}}function Ou(){return"undefined"!=typeof document?document:null}function Ru(t){return new bc(t,!0)}class Pu{constructor(t,e,n=1e3,r=1.5,i=6e4){this.oi=t,this.timerId=e,this.Mo=n,this.xo=r,this.Oo=i,this.No=0,this.Lo=null,this.Bo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(t){this.cancel();const e=Math.floor(this.No+this.Qo()),n=Math.max(0,Date.now()-this.Bo),r=Math.max(0,e-n);r>0&&Bi("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.No} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Lo=this.oi.enqueueAfterDelay(this.timerId,r,(()=>(this.Bo=Date.now(),t()))),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){null!==this.Lo&&(this.Lo.skipDelay(),this.Lo=null)}cancel(){null!==this.Lo&&(this.Lo.cancel(),this.Lo=null)}Qo(){return(Math.random()-.5)*this.No}}class Fu{constructor(t,e,n,r,i,s,o,a){this.oi=t,this.$o=n,this.Uo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new Pu(t,e)}Ho(){return 1===this.state||5===this.state||this.Jo()}Jo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Yo()}async stop(){this.Ho()&&await this.close(0)}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&null===this.Go&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,(()=>this.e_())))}t_(t){this.n_(),this.stream.send(t)}async e_(){if(this.Jo())return this.close(0)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}async close(t,e){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,4!==t?this.jo.reset():e&&e.code===Hi.RESOURCE_EXHAUSTED?(ji(e.toString()),ji("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):e&&e.code===Hi.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.i_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.To(e)}i_(){}auth(){this.state=1;const t=this.s_(this.Wo),e=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.Wo===e&&this.o_(t,n)}),(e=>{t((()=>{const t=new Qi(Hi.UNKNOWN,"Fetching auth token failed: "+e.message);return this.__(t)}))}))}o_(t,e){const n=this.s_(this.Wo);this.stream=this.a_(t,e),this.stream.Po((()=>{n((()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,(()=>(this.Jo()&&(this.state=3),Promise.resolve()))),this.listener.Po())))})),this.stream.To((t=>{n((()=>this.__(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Yo(){this.state=5,this.jo.qo((async()=>{this.state=0,this.start()}))}__(t){return Bi("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}s_(t){return e=>{this.oi.enqueueAndForget((()=>this.Wo===t?e():(Bi("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Vu extends Fu{constructor(t,e,n,r,i,s){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,r,s),this.serializer=i}a_(t,e){return this.connection.Fo("Listen",t,e)}onMessage(t){this.jo.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:zi()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(t,e){return t.useProto3Json?(Gi(void 0===e||"string"==typeof e),zs.fromBase64String(e||"")):(Gi(void 0===e||e instanceof Uint8Array),zs.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?Hi.UNKNOWN:nc(t.code);return new Qi(e,t.message||"")}(o);n=new dc(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Nc(t,r.document.name),s=Ic(r.document.updateTime),o=r.document.createTime?Ic(r.document.createTime):us.min(),a=new yo({mapValue:{fields:r.document.fields}}),c=wo.newFoundDocument(i,s,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];n=new hc(u,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Nc(t,r.document),s=r.readTime?Ic(r.readTime):us.min(),o=wo.newNoDocument(i,s),a=r.removedTargetIds||[];n=new hc([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Nc(t,r.document),s=r.removedTargetIds||[];n=new hc([],s,i,null)}else{if(!("filter"in e))return zi();{e.filter;const t=e.filter;t.targetId;const{count:r=0,unchangedNames:i}=t,s=new Za(r,i),o=t.targetId;n=new lc(o,s)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return us.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?us.min():e.readTime?Ic(e.readTime):us.min()}(t);return this.listener.u_(e,n)}c_(t){const e={};e.database=Mc(this.serializer),e.addTarget=function(t,e){let n;const r=e.target;if(n=Go(r)?{documents:Rc(t,r)}:{query:Pc(t,r).ut},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=Tc(t,e.resumeToken);const r=Ec(t,e.expectedCount);null!==r&&(n.expectedCount=r)}else if(e.snapshotVersion.compareTo(us.min())>0){n.readTime=_c(t,e.snapshotVersion.toTimestamp());const r=Ec(t,e.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return zi()}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.t_(e)}l_(t){const e={};e.database=Mc(this.serializer),e.removeTarget=t,this.t_(e)}}class Uu extends Fu{constructor(t,e,n,r,i,s){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,r,s),this.serializer=i,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(t,e){return this.connection.Fo("Write",t,e)}onMessage(t){if(Gi(!!t.streamToken),this.lastStreamToken=t.streamToken,this.h_){this.jo.reset();const e=function(t,e){return t&&t.length>0?(Gi(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?Ic(t.updateTime):Ic(e);return n.isEqual(us.min())&&(n=Ic(e)),new Oa(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=Ic(t.commitTime);return this.listener.T_(n,e)}return Gi(!t.writeResults||0===t.writeResults.length),this.h_=!0,this.listener.E_()}d_(){const t={};t.database=Mc(this.serializer),this.t_(t)}I_(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>function(t,e){let n;if(e instanceof $a)n={update:Oc(t,e.key,e.value)};else if(e instanceof Qa)n={delete:kc(t,e.key)};else if(e instanceof za)n={update:Oc(t,e.key,e.data),updateMask:Gc(e.fieldMask)};else{if(!(e instanceof Wa))return zi();n={verify:kc(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof Ca)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Da)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof ka)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof xa)return{fieldPath:e.field.canonicalString(),increment:n.Ie};throw zi()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Sc(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:zi()}(t,e.precondition)),n}(this.serializer,t)))};this.t_(e)}}class Bu extends class{}{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=r,this.A_=!1}R_(){if(this.A_)throw new Qi(Hi.FAILED_PRECONDITION,"The client has already been terminated.")}So(t,e,n,r){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.So(t,Dc(e,n),r,i,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Hi.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Qi(Hi.UNKNOWN,t.toString())}))}vo(t,e,n,r,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,o])=>this.connection.vo(t,Dc(e,n),r,s,o,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Hi.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Qi(Hi.UNKNOWN,t.toString())}))}terminate(){this.A_=!0,this.connection.terminate()}}class ju{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){0===this.m_&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve()))))}S_(t){"Online"===this.state?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.y_("Offline")))}set(t){this.b_(),this.m_=0,"Online"===t&&(this.g_=!1),this.y_(t)}y_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}w_(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(ji(e),this.g_=!1):Bi("OnlineStateTracker",e)}b_(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}}class qu{constructor(t,e,n,r,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=i,this.M_.io((t=>{n.enqueueAndForget((async()=>{Xu(this)&&(Bi("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Ki(t);e.v_.add(4),await zu(e),e.x_.set("Unknown"),e.v_.delete(4),await $u(e)}(this))}))})),this.x_=new ju(n,r)}}async function $u(t){if(Xu(t))for(const e of t.F_)await e(!0)}async function zu(t){for(const e of t.F_)await e(!1)}function Gu(t,e){const n=Ki(t);n.C_.has(e.targetId)||(n.C_.set(e.targetId,e),Yu(n)?Wu(n):gh(n).Jo()&&Hu(n,e))}function Ku(t,e){const n=Ki(t),r=gh(n);n.C_.delete(e),r.Jo()&&Qu(n,e),0===n.C_.size&&(r.Jo()?r.Xo():Xu(n)&&n.x_.set("Unknown"))}function Hu(t,e){if(t.O_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(us.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}gh(t).c_(e)}function Qu(t,e){t.O_.Oe(e),gh(t).l_(e)}function Wu(t){t.O_=new gc({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>t.C_.get(e)||null,nt:()=>t.datastore.serializer.databaseId}),gh(t).start(),t.x_.p_()}function Yu(t){return Xu(t)&&!gh(t).Ho()&&t.C_.size>0}function Xu(t){return 0===Ki(t).v_.size}function Ju(t){t.O_=void 0}async function Zu(t){t.C_.forEach(((e,n)=>{Hu(t,e)}))}async function th(t,e){Ju(t),Yu(t)?(t.x_.S_(e),Wu(t)):t.x_.set("Unknown")}async function eh(t,e,n){if(t.x_.set("Online"),e instanceof dc&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.C_.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.C_.delete(r),t.O_.removeTarget(r))}(t,e)}catch(n){Bi("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await nh(t,n)}else if(e instanceof hc?t.O_.$e(e):e instanceof lc?t.O_.Je(e):t.O_.Ge(e),!n.isEqual(us.min()))try{const e=await bu(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.O_.it(e);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=t.C_.get(r);i&&t.C_.set(r,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const r=t.C_.get(e);if(!r)return;t.C_.set(e,r.withResumeToken(zs.EMPTY_BYTE_STRING,r.snapshotVersion)),Qu(t,e);const i=new Hc(r.target,e,n,r.sequenceNumber);Hu(t,i)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){Bi("RemoteStore","Failed to raise snapshot:",e),await nh(t,e)}}async function nh(t,e,n){if(!Cs(e))throw e;t.v_.add(1),await zu(t),t.x_.set("Offline"),n||(n=()=>bu(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Bi("RemoteStore","Retrying IndexedDB access"),await n(),t.v_.delete(1),await $u(t)}))}function rh(t,e){return e().catch((n=>nh(t,n,e)))}async function ih(t){const e=Ki(t),n=ph(e);let r=e.D_.length>0?e.D_[e.D_.length-1].batchId:-1;for(;sh(e);)try{const t=await Eu(e.localStore,r);if(null===t){0===e.D_.length&&n.Xo();break}r=t.batchId,oh(e,t)}catch(t){await nh(e,t)}ah(e)&&ch(e)}function sh(t){return Xu(t)&&t.D_.length<10}function oh(t,e){t.D_.push(e);const n=ph(t);n.Jo()&&n.P_&&n.I_(e.mutations)}function ah(t){return Xu(t)&&!ph(t).Ho()&&t.D_.length>0}function ch(t){ph(t).start()}async function uh(t){ph(t).d_()}async function hh(t){const e=ph(t);for(const n of t.D_)e.I_(n.mutations)}async function lh(t,e,n){const r=t.D_.shift(),i=Xa.from(r,e,n);await rh(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await ih(t)}async function dh(t,e){e&&ph(t).P_&&await async function(t,e){if(function(t){return function(t){switch(t){default:return zi();case Hi.CANCELLED:case Hi.UNKNOWN:case Hi.DEADLINE_EXCEEDED:case Hi.RESOURCE_EXHAUSTED:case Hi.INTERNAL:case Hi.UNAVAILABLE:case Hi.UNAUTHENTICATED:return!1;case Hi.INVALID_ARGUMENT:case Hi.NOT_FOUND:case Hi.ALREADY_EXISTS:case Hi.PERMISSION_DENIED:case Hi.FAILED_PRECONDITION:case Hi.ABORTED:case Hi.OUT_OF_RANGE:case Hi.UNIMPLEMENTED:case Hi.DATA_LOSS:return!0}}(t)&&t!==Hi.ABORTED}(e.code)){const n=t.D_.shift();ph(t).Zo(),await rh(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await ih(t)}}(t,e),ah(t)&&ch(t)}async function fh(t,e){const n=Ki(t);n.asyncQueue.verifyOperationInProgress(),Bi("RemoteStore","RemoteStore received new credentials");const r=Xu(n);n.v_.add(3),await zu(n),r&&n.x_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.v_.delete(3),await $u(n)}function gh(t){return t.N_||(t.N_=function(t,e,n){const r=Ki(t);return r.R_(),new Vu(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Po:Zu.bind(null,t),To:th.bind(null,t),u_:eh.bind(null,t)}),t.F_.push((async e=>{e?(t.N_.Zo(),Yu(t)?Wu(t):t.x_.set("Unknown")):(await t.N_.stop(),Ju(t))}))),t.N_}function ph(t){return t.L_||(t.L_=function(t,e,n){const r=Ki(t);return r.R_(),new Uu(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Po:uh.bind(null,t),To:dh.bind(null,t),E_:hh.bind(null,t),T_:lh.bind(null,t)}),t.F_.push((async e=>{e?(t.L_.Zo(),await ih(t)):(await t.L_.stop(),t.D_.length>0&&(Bi("RemoteStore",`Stopping write stream with ${t.D_.length} pending writes`),t.D_=[]))}))),t.L_}class mh{constructor(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Wi,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,r,i){const s=Date.now()+n,o=new mh(t,e,s,r,i);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Qi(Hi.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function yh(t,e){if(ji("AsyncQueue",`${e}: ${t}`),Cs(t))return new Qi(Hi.UNAVAILABLE,`${e}: ${t}`);throw t}class vh{constructor(t){this.comparator=t?(e,n)=>t(e,n)||gs.comparator(e.key,n.key):(t,e)=>gs.comparator(t.key,e.key),this.keyedMap=ha(),this.sortedSet=new Fs(this.comparator)}static emptySet(t){return new vh(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof vh))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new vh;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class wh{constructor(){this.B_=new Fs(gs.comparator)}track(t){const e=t.doc.key,n=this.B_.get(e);n?0!==t.type&&3===n.type?this.B_=this.B_.insert(e,t):3===t.type&&1!==n.type?this.B_=this.B_.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.B_=this.B_.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.B_=this.B_.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.B_=this.B_.remove(e):1===t.type&&2===n.type?this.B_=this.B_.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.B_=this.B_.insert(e,{type:2,doc:t.doc}):zi():this.B_=this.B_.insert(e,t)}k_(){const t=[];return this.B_.inorderTraversal(((e,n)=>{t.push(n)})),t}}class bh{constructor(t,e,n,r,i,s,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,r,i){const s=[];return e.forEach((t=>{s.push({type:0,doc:t})})),new bh(t,e,vh.emptySet(e),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&ta(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class Eh{constructor(){this.q_=void 0,this.Q_=[]}K_(){return this.Q_.some((t=>t.U_()))}}class _h{constructor(){this.queries=new oa((t=>ea(t)),ta),this.onlineState="Unknown",this.W_=new Set}}function Th(t,e){const n=Ki(t);let r=!1;for(const t of e){const e=t.query,i=n.queries.get(e);if(i){for(const e of i.Q_)e.z_(t)&&(r=!0);i.q_=t}}r&&Ih(n)}function Sh(t,e,n){const r=Ki(t),i=r.queries.get(e);if(i)for(const t of i.Q_)t.onError(n);r.queries.delete(e)}function Ih(t){t.W_.forEach((t=>{t.next()}))}var Ch,Dh;(Dh=Ch||(Ch={})).j_="default",Dh.Cache="cache";class Ah{constructor(t,e,n){this.query=t,this.H_=e,this.J_=!1,this.Y_=null,this.onlineState="Unknown",this.options=n||{}}z_(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new bh(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.J_?this.Z_(t)&&(this.H_.next(t),e=!0):this.X_(t,this.onlineState)&&(this.ea(t),e=!0),this.Y_=t,e}onError(t){this.H_.error(t)}G_(t){this.onlineState=t;let e=!1;return this.Y_&&!this.J_&&this.X_(this.Y_,t)&&(this.ea(this.Y_),e=!0),e}X_(t,e){if(!t.fromCache)return!0;if(!this.U_())return!0;const n="Offline"!==e;return(!this.options.ta||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}Z_(t){if(t.docChanges.length>0)return!0;const e=this.Y_&&this.Y_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}ea(t){t=bh.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.J_=!0,this.H_.next(t)}U_(){return this.options.source!==Ch.Cache}}class kh{constructor(t){this.key=t}}class Nh{constructor(t){this.key=t}}class xh{constructor(t,e){this.query=t,this.ua=e,this.ca=null,this.hasCachedResults=!1,this.current=!1,this.la=ya(),this.mutatedKeys=ya(),this.ha=ia(t),this.Pa=new vh(this.ha)}get Ia(){return this.ua}Ta(t,e){const n=e?e.Ea:new wh,r=e?e.Pa:this.Pa;let i=e?e.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal(((t,e)=>{const u=r.get(t),h=ra(this.query,e)?e:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.da(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.ha(h,a)>0||c&&this.ha(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(s=s.add(h),i=d?i.add(t):i.delete(t)):(s=s.delete(t),i=i.delete(t)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const t="F"===this.query.limitType?s.last():s.first();s=s.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{Pa:s,Ea:n,Xi:o,mutatedKeys:i}}da(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,r){const i=this.Pa;this.Pa=t.Pa,this.mutatedKeys=t.mutatedKeys;const s=t.Ea.k_();s.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return zi()}};return n(t)-n(e)}(t.type,e.type)||this.ha(t.doc,e.doc))),this.Aa(n),r=null!=r&&r;const o=e&&!r?this.Ra():[],a=0===this.la.size&&this.current&&!r?1:0,c=a!==this.ca;return this.ca=a,0!==s.length||c?{snapshot:new bh(this.query,t.Pa,i,s,t.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),Va:o}:{Va:o}}G_(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Pa:this.Pa,Ea:new wh,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{Va:[]}}ma(t){return!this.ua.has(t)&&!!this.Pa.has(t)&&!this.Pa.get(t).hasLocalMutations}Aa(t){t&&(t.addedDocuments.forEach((t=>this.ua=this.ua.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.ua=this.ua.delete(t))),this.current=t.current)}Ra(){if(!this.current)return[];const t=this.la;this.la=ya(),this.Pa.forEach((t=>{this.ma(t.key)&&(this.la=this.la.add(t.key))}));const e=[];return t.forEach((t=>{this.la.has(t)||e.push(new Nh(t))})),this.la.forEach((n=>{t.has(n)||e.push(new kh(n))})),e}fa(t){this.ua=t.hs,this.la=ya();const e=this.Ta(t.documents);return this.applyChanges(e,!0)}ga(){return bh.fromInitialDocuments(this.query,this.Pa,this.mutatedKeys,0===this.ca,this.hasCachedResults)}}class Mh{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Lh{constructor(t){this.key=t,this.pa=!1}}class Oh{constructor(t,e,n,r,i,s){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.ya={},this.wa=new oa((t=>ea(t)),ta),this.Sa=new Map,this.ba=new Set,this.Da=new Fs(gs.comparator),this.Ca=new Map,this.va=new ou,this.Fa={},this.Ma=new Map,this.xa=tu.Ln(),this.onlineState="Unknown",this.Oa=void 0}get isPrimaryClient(){return!0===this.Oa}}async function Rh(t,e,n=!0){const r=el(t);let i;const s=r.wa.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ga()):i=await Fh(r,e,n,!0),i}async function Ph(t,e){const n=el(t);await Fh(n,e,!0,!1)}async function Fh(t,e,n,r){const i=await function(t,e){const n=Ki(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let r;return n.Qr.getTargetData(t,e).next((i=>i?(r=i,Es.resolve(r)):n.Qr.allocateTargetId(t).next((i=>(r=new Hc(e,i,"TargetPurposeListen",t.currentSequenceNumber),n.Qr.addTargetData(t,r).next((()=>r)))))))})).then((t=>{const r=n.ns.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.ns=n.ns.insert(t.targetId,t),n.rs.set(e,t.targetId)),t}))}(t.localStore,Xo(e)),s=i.targetId,o=n?t.sharedClientState.addLocalQueryTarget(s):"not-current";let a;return r&&(a=await async function(t,e,n,r,i){t.Na=(e,n,r)=>async function(t,e,n,r){let i=e.view.Ta(n);i.Xi&&(i=await Tu(t.localStore,e.query,!1).then((({documents:t})=>e.view.Ta(t,i))));const s=r&&r.targetChanges.get(e.targetId),o=r&&null!=r.targetMismatches.get(e.targetId),a=e.view.applyChanges(i,t.isPrimaryClient,s,o);return Wh(t,e.targetId,a.Va),a.snapshot}(t,e,n,r);const s=await Tu(t.localStore,e,!0),o=new xh(e,s.hs),a=o.Ta(s.documents),c=uc.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState,i),u=o.applyChanges(a,t.isPrimaryClient,c);Wh(t,n,u.Va);const h=new Mh(e,n,o);return t.wa.set(e,h),t.Sa.has(n)?t.Sa.get(n).push(e):t.Sa.set(n,[e]),u.snapshot}(t,e,s,"current"===o,i.resumeToken)),t.isPrimaryClient&&n&&Gu(t.remoteStore,i),a}async function Vh(t,e,n){const r=Ki(t),i=r.wa.get(e),s=r.Sa.get(i.targetId);if(s.length>1)return r.Sa.set(i.targetId,s.filter((t=>!ta(t,e)))),void r.wa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await _u(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&Ku(r.remoteStore,i.targetId),Hh(r,i.targetId)})).catch(bs)):(Hh(r,i.targetId),await _u(r.localStore,i.targetId,!0))}async function Uh(t,e){const n=Ki(t),r=n.wa.get(e),i=n.Sa.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Ku(n.remoteStore,r.targetId))}async function Bh(t,e){const n=Ki(t);try{const t=await function(t,e){const n=Ki(t),r=e.snapshotVersion;let i=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const s=n.os.newChangeBuffer({trackRemovals:!0});i=n.ns;const o=[];e.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Qr.removeMatchingKeys(t,s.removedDocuments,a).next((()=>n.Qr.addMatchingKeys(t,s.addedDocuments,a))));let u=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?u=u.withResumeToken(zs.EMPTY_BYTE_STRING,us.min()).withLastLimboFreeSnapshotVersion(us.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.Qr.updateTargetData(t,u))}));let a=ca(),c=ya();if(e.documentUpdates.forEach((r=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),o.push(function(t,e,n){let r=ya(),i=ya();return n.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=ca();return n.forEach(((n,s)=>{const o=t.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(us.min())?(e.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(s),r=r.insert(n,s)):Bi("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{cs:r,ls:i}}))}(t,s,e.documentUpdates).next((t=>{a=t.cs,c=t.ls}))),!r.isEqual(us.min())){const e=n.Qr.getLastRemoteSnapshotVersion(t).next((e=>n.Qr.setTargetsMetadata(t,t.currentSequenceNumber,r)));o.push(e)}return Es.waitFor(o).next((()=>s.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.ns=i,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const r=n.Ca.get(e);r&&(Gi(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.pa=!0:t.modifiedDocuments.size>0?Gi(r.pa):t.removedDocuments.size>0&&(Gi(r.pa),r.pa=!1))})),await Jh(n,t,e)}catch(t){await bs(t)}}function jh(t,e,n){const r=Ki(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.wa.forEach(((n,r)=>{const i=r.view.G_(e);i.snapshot&&t.push(i.snapshot)})),function(t,e){const n=Ki(t);n.onlineState=e;let r=!1;n.queries.forEach(((t,n)=>{for(const t of n.Q_)t.G_(e)&&(r=!0)})),r&&Ih(n)}(r.eventManager,e),t.length&&r.ya.u_(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function qh(t,e,n){const r=Ki(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Ca.get(e),s=i&&i.key;if(s){let t=new Fs(gs.comparator);t=t.insert(s,wo.newNoDocument(s,us.min()));const n=ya().add(s),i=new cc(us.min(),new Map,new Fs(os),t,n);await Bh(r,i),r.Da=r.Da.remove(s),r.Ca.delete(e),Xh(r)}else await _u(r.localStore,e,!1).then((()=>Hh(r,e,n))).catch(bs)}async function $h(t,e){const n=Ki(t),r=e.batch.batchId;try{const t=await function(t,e){const n=Ki(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const r=e.batch.keys(),i=n.os.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){const i=n.batch,s=i.keys();let o=Es.resolve();return s.forEach((t=>{o=o.next((()=>r.getEntry(e,t))).next((e=>{const s=n.docVersions.get(t);Gi(null!==s),e.version.compareTo(s)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),r.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,i)))}(n,t,e,i).next((()=>i.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=ya();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(n.localStore,e);Kh(n,r,null),Gh(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Jh(n,t)}catch(t){await bs(t)}}async function zh(t,e,n){const r=Ki(t);try{const t=await function(t,e){const n=Ki(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let r;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(Gi(null!==e),r=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,r))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(r.localStore,e);Kh(r,e,n),Gh(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await Jh(r,t)}catch(n){await bs(n)}}function Gh(t,e){(t.Ma.get(e)||[]).forEach((t=>{t.resolve()})),t.Ma.delete(e)}function Kh(t,e,n){const r=Ki(t);let i=r.Fa[r.currentUser.toKey()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.Fa[r.currentUser.toKey()]=i}}function Hh(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Sa.get(e))t.wa.delete(r),n&&t.ya.La(r,n);t.Sa.delete(e),t.isPrimaryClient&&t.va.Vr(e).forEach((e=>{t.va.containsKey(e)||Qh(t,e)}))}function Qh(t,e){t.ba.delete(e.path.canonicalString());const n=t.Da.get(e);null!==n&&(Ku(t.remoteStore,n),t.Da=t.Da.remove(e),t.Ca.delete(n),Xh(t))}function Wh(t,e,n){for(const r of n)r instanceof kh?(t.va.addReference(r.key,e),Yh(t,r)):r instanceof Nh?(Bi("SyncEngine","Document no longer in limbo: "+r.key),t.va.removeReference(r.key,e),t.va.containsKey(r.key)||Qh(t,r.key)):zi()}function Yh(t,e){const n=e.key,r=n.path.canonicalString();t.Da.get(n)||t.ba.has(r)||(Bi("SyncEngine","New document in limbo: "+n),t.ba.add(r),Xh(t))}function Xh(t){for(;t.ba.size>0&&t.Da.size<t.maxConcurrentLimboResolutions;){const e=t.ba.values().next().value;t.ba.delete(e);const n=new gs(ls.fromString(e)),r=t.xa.next();t.Ca.set(r,new Lh(n)),t.Da=t.Da.insert(n,r),Gu(t.remoteStore,new Hc(Xo(Ho(n.path)),r,"TargetPurposeLimboResolution",xs._e))}}async function Jh(t,e,n){const r=Ki(t),i=[],s=[],o=[];r.wa.isEmpty()||(r.wa.forEach(((t,a)=>{o.push(r.Na(a,e,n).then((t=>{if((t||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){i.push(t);const e=pu.Ki(a.targetId,t);s.push(e)}})))})),await Promise.all(o),r.ya.u_(i),await async function(t,e){const n=Ki(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>Es.forEach(e,(e=>Es.forEach(e.qi,(r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>Es.forEach(e.Qi,(r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!Cs(t))throw t;Bi("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.ns.get(e),r=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(r);n.ns=n.ns.insert(e,i)}}}(r.localStore,s))}async function Zh(t,e){const n=Ki(t);if(!n.currentUser.isEqual(e)){Bi("SyncEngine","User change. New user:",e.toKey());const t=await wu(n.localStore,e);n.currentUser=e,function(t,e){t.Ma.forEach((t=>{t.forEach((t=>{t.reject(new Qi(Hi.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Ma.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Jh(n,t.us)}}function tl(t,e){const n=Ki(t),r=n.Ca.get(e);if(r&&r.pa)return ya().add(r.key);{let t=ya();const r=n.Sa.get(e);if(!r)return t;for(const e of r){const r=n.wa.get(e);t=t.unionWith(r.view.Ia)}return t}}function el(t){const e=Ki(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Bh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=tl.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=qh.bind(null,e),e.ya.u_=Th.bind(null,e.eventManager),e.ya.La=Sh.bind(null,e.eventManager),e}function nl(t){const e=Ki(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=$h.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=zh.bind(null,e),e}class rl{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=Ru(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return function(t,e,n,r){return new vu(t,e,n,r)}(this.persistence,new yu,t.initialUser,this.serializer)}createPersistence(t){return new du(gu.Hr,this.serializer)}createSharedClientState(t){return new Iu}async terminate(){var t,e;null===(t=this.gcScheduler)||void 0===t||t.stop(),null===(e=this.indexBackfillerScheduler)||void 0===e||e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class il{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>jh(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=Zh.bind(null,this.syncEngine),await async function(t,e){const n=Ki(t);e?(n.v_.delete(2),await $u(n)):e||(n.v_.add(2),await zu(n),n.x_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new _h}createDatastore(t){const e=Ru(t.databaseInfo.databaseId),n=function(t){return new Lu(t)}(t.databaseInfo);return function(t,e,n,r){return new Bu(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,r,i){return new qu(t,e,n,r,i)}(this.localStore,this.datastore,t.asyncQueue,(t=>jh(this.syncEngine,t,0)),Du.D()?new Du:new Cu)}createSyncEngine(t,e){return function(t,e,n,r,i,s,o){const a=new Oh(t,e,n,r,i,s);return o&&(a.Oa=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t;await async function(t){const e=Ki(t);Bi("RemoteStore","RemoteStore shutting down."),e.v_.add(5),await zu(e),e.M_.shutdown(),e.x_.set("Unknown")}(this.remoteStore),null===(t=this.datastore)||void 0===t||t.terminate()}}class sl{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.qa(this.observer.next,t)}error(t){this.observer.error?this.qa(this.observer.error,t):ji("Uncaught Error in snapshot listener:",t.toString())}Qa(){this.muted=!0}qa(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class ol{constructor(t,e,n,r){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=Pi.UNAUTHENTICATED,this.clientId=ss.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{Bi("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(Bi("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Qi(Hi.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Wi;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=yh(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function al(t,e){t.asyncQueue.verifyOperationInProgress(),Bi("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await wu(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function cl(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Bi("FirestoreClient","Using user provided OfflineComponentProvider");try{await al(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===Hi.FAILED_PRECONDITION||t.code===Hi.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;qi("Error using user provided cache. Falling back to memory cache: "+n),await al(t,new rl)}}else Bi("FirestoreClient","Using default OfflineComponentProvider"),await al(t,new rl);return t._offlineComponents}(t);Bi("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((t=>fh(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>fh(e.remoteStore,n))),t._onlineComponents=e}async function ul(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Bi("FirestoreClient","Using user provided OnlineComponentProvider"),await cl(t,t._uninitializedComponentsProvider._online)):(Bi("FirestoreClient","Using default OnlineComponentProvider"),await cl(t,new il))),t._onlineComponents}async function hl(t){const e=await ul(t),n=e.eventManager;return n.onListen=Rh.bind(null,e.syncEngine),n.onUnlisten=Vh.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=Ph.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=Uh.bind(null,e.syncEngine),n}function ll(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const dl=new Map;function fl(t,e,n){if(!n)throw new Qi(Hi.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function gl(t){if(!gs.isDocumentKey(t))throw new Qi(Hi.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function pl(t){if(gs.isDocumentKey(t))throw new Qi(Hi.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function ml(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":zi()}function yl(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Qi(Hi.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=ml(t);throw new Qi(Hi.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class vl{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new Qi(Hi.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Qi(Hi.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,r){if(!0===e&&!0===r)throw new Qi(Hi.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ll(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new Qi(Hi.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new Qi(Hi.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new Qi(Hi.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class wl{constructor(t,e,n,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new vl({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Qi(Hi.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Qi(Hi.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new vl(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new Xi;switch(t.type){case"firstParty":return new es(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new Qi(Hi.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=dl.get(t);e&&(Bi("ComponentProvider","Removing Datastore"),dl.delete(t),e.terminate())}(this),Promise.resolve()}}class bl{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new bl(this.firestore,t,this._query)}}class El{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new _l(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new El(this.firestore,t,this._key)}}class _l extends bl{constructor(t,e,n){super(t,e,Ho(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new El(this.firestore,null,new gs(t))}withConverter(t){return new _l(this.firestore,t,this._path)}}function Tl(t,e,...n){if(t=p(t),fl("collection","path",e),t instanceof wl){const r=ls.fromString(e,...n);return pl(r),new _l(t,null,r)}{if(!(t instanceof El||t instanceof _l))throw new Qi(Hi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(ls.fromString(e,...n));return pl(r),new _l(t.firestore,null,r)}}class Sl{constructor(){this.nu=Promise.resolve(),this.ru=[],this.iu=!1,this.su=[],this.ou=null,this._u=!1,this.au=!1,this.uu=[],this.jo=new Pu(this,"async_queue_retry"),this.cu=()=>{const t=Ou();t&&Bi("AsyncQueue","Visibility state changed to "+t.visibilityState),this.jo.Ko()};const t=Ou();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.cu)}get isShuttingDown(){return this.iu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.lu(),this.hu(t)}enterRestrictedMode(t){if(!this.iu){this.iu=!0,this.au=t||!1;const e=Ou();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.cu)}}enqueue(t){if(this.lu(),this.iu)return new Promise((()=>{}));const e=new Wi;return this.hu((()=>this.iu&&this.au?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.ru.push(t),this.Pu())))}async Pu(){if(0!==this.ru.length){try{await this.ru[0](),this.ru.shift(),this.jo.reset()}catch(t){if(!Cs(t))throw t;Bi("AsyncQueue","Operation failed with retryable error: "+t)}this.ru.length>0&&this.jo.qo((()=>this.Pu()))}}hu(t){const e=this.nu.then((()=>(this._u=!0,t().catch((t=>{this.ou=t,this._u=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw ji("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this._u=!1,t))))));return this.nu=e,e}enqueueAfterDelay(t,e,n){this.lu(),this.uu.indexOf(t)>-1&&(e=0);const r=mh.createAndSchedule(this,t,e,n,(t=>this.Iu(t)));return this.su.push(r),r}lu(){this.ou&&zi()}verifyOperationInProgress(){}async Tu(){let t;do{t=this.nu,await t}while(t!==this.nu)}Eu(t){for(const e of this.su)if(e.timerId===t)return!0;return!1}du(t){return this.Tu().then((()=>{this.su.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.su)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Tu()}))}Au(t){this.uu.push(t)}Iu(t){const e=this.su.indexOf(t);this.su.splice(e,1)}}function Il(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return!0;return!1}(t)}class Cl extends wl{constructor(t,e,n,r){super(t,e,n,r),this.type="firestore",this._queue=new Sl,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Al(this),this._firestoreClient.terminate()}}function Dl(t){return t._firestoreClient||Al(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Al(t){var e,n,r;const i=t._freezeSettings(),s=function(t,e,n,r){return new Js(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,ll(r.experimentalLongPollingOptions),r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,i);t._firestoreClient=new ol(t._authCredentials,t._appCheckCredentials,t._queue,s),(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}class kl{constructor(t){this._byteString=t}static fromBase64String(t){try{return new kl(zs.fromBase64String(t))}catch(t){throw new Qi(Hi.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new kl(zs.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class Nl{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Qi(Hi.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new fs(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class xl{constructor(t){this._methodName=t}}class Ml{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Qi(Hi.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Qi(Hi.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return os(this._lat,t._lat)||os(this._long,t._long)}}const Ll=/^__.*__$/;class Ol{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new za(t,this.data,this.fieldMask,e,this.fieldTransforms):new $a(t,this.data,e,this.fieldTransforms)}}function Rl(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw zi()}}class Pl{constructor(t,e,n,r,i,s){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Ru(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Vu(){return this.settings.Vu}mu(t){return new Pl(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}fu(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.mu({path:n,gu:!1});return r.pu(t),r}yu(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.mu({path:n,gu:!1});return r.Ru(),r}wu(t){return this.mu({path:void 0,gu:!0})}Su(t){return Hl(t,this.settings.methodName,this.settings.bu||!1,this.path,this.settings.Du)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}Ru(){if(this.path)for(let t=0;t<this.path.length;t++)this.pu(this.path.get(t))}pu(t){if(0===t.length)throw this.Su("Document fields must not be empty");if(Rl(this.Vu)&&Ll.test(t))throw this.Su('Document fields cannot begin and end with "__"')}}class Fl{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Ru(t)}Cu(t,e,n,r=!1){return new Pl({Vu:t,methodName:e,Du:n,path:fs.emptyPath(),gu:!1,bu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Vl(t){const e=t._freezeSettings(),n=Ru(t._databaseId);return new Fl(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Ul(t,e,n,r,i,s={}){const o=t.Cu(s.merge||s.mergeFields?2:0,e,n,i);$l("Data must be an object, but it was:",o,r);const a=jl(r,o);let c,u;if(s.merge)c=new qs(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const t=[];for(const r of s.mergeFields){const i=zl(e,r,n);if(!o.contains(i))throw new Qi(Hi.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Ql(t,i)||t.push(i)}c=new qs(t),u=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,u=o.fieldTransforms;return new Ol(new yo(a),c,u)}function Bl(t,e){if(ql(t=p(t)))return $l("Unsupported field value:",e,t),jl(t,e);if(t instanceof xl)return function(t,e){if(!Rl(e.Vu))throw e.Su(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.Su(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.gu&&4!==e.Vu)throw e.Su("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const i of t){let t=Bl(i,e.wu(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=p(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Ea(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=cs.fromDate(t);return{timestampValue:_c(e.serializer,n)}}if(t instanceof cs){const n=new cs(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:_c(e.serializer,n)}}if(t instanceof Ml)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof kl)return{bytesValue:Tc(e.serializer,t._byteString)};if(t instanceof El){const n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Su(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Cc(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Su(`Unsupported field value: ${ml(t)}`)}(t,e)}function jl(t,e){const n={};return Ps(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Rs(t,((t,r)=>{const i=Bl(r,e.fu(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function ql(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof cs||t instanceof Ml||t instanceof kl||t instanceof El||t instanceof xl)}function $l(t,e,n){if(!ql(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const r=ml(n);throw"an object"===r?e.Su(t+" a custom object"):e.Su(t+" "+r)}}function zl(t,e,n){if((e=p(e))instanceof Nl)return e._internalPath;if("string"==typeof e)return Kl(t,e);throw Hl("Field path arguments must be of type string or ",t,!1,void 0,n)}const Gl=new RegExp("[~\\*/\\[\\]]");function Kl(t,e,n){if(e.search(Gl)>=0)throw Hl(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Nl(...e.split("."))._internalPath}catch(r){throw Hl(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Hl(t,e,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new Qi(Hi.INVALID_ARGUMENT,a+t+c)}function Ql(t,e){return t.some((t=>t.isEqual(e)))}class Wl{constructor(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new El(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Yl(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Xl("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Yl extends Wl{data(){return super.data()}}function Xl(t,e){return"string"==typeof e?Kl(t,e):e instanceof Nl?e._internalPath:e._delegate._internalPath}class Jl{}class Zl extends Jl{}class td extends Zl{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new td(t,e,n)}_apply(t){const e=this._parse(t);return sd(t._query,e),new bl(t.firestore,t.converter,Jo(t._query,e))}_parse(t){const e=Vl(t.firestore),n=function(t,e,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new Qi(Hi.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){id(o,s);const e=[];for(const n of o)e.push(rd(r,t,n));a={arrayValue:{values:e}}}else a=rd(r,t,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||id(o,s),a=function(t,e,n,r=!1){return Bl(n,t.Cu(r?4:3,e))}(n,"where",o,"in"===s||"not-in"===s);return Co.create(i,s,a)}(t._query,0,e,t.firestore._databaseId,this._field,this._op,this._value);return n}}class ed extends Jl{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new ed(t,e)}_parse(t){const e=this._queryConstraints.map((e=>e._parse(t))).filter((t=>t.getFilters().length>0));return 1===e.length?e[0]:Do.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return 0===e.getFilters().length?t:(function(t,e){let n=t;const r=e.getFlattenedFilters();for(const t of r)sd(n,t),n=Jo(n,t)}(t._query,e),new bl(t.firestore,t.converter,Jo(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class nd extends Zl{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new nd(t,e)}_apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new Qi(Hi.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Qi(Hi.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new To(e,n)}(t._query,this._field,this._direction);return new bl(t.firestore,t.converter,function(t,e){const n=t.explicitOrderBy.concat([e]);return new Ko(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))}}function rd(t,e,n){if("string"==typeof(n=p(n))){if(""===n)throw new Qi(Hi.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Wo(e)&&-1!==n.indexOf("/"))throw new Qi(Hi.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(ls.fromString(n));if(!gs.isDocumentKey(r))throw new Qi(Hi.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return co(t,new gs(r))}if(n instanceof El)return co(t,n._key);throw new Qi(Hi.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ml(n)}.`)}function id(t,e){if(!Array.isArray(t)||0===t.length)throw new Qi(Hi.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function sd(t,e){const n=function(t,e){for(const n of t)for(const t of n.getFlattenedFilters())if(e.indexOf(t.op)>=0)return t.op;return null}(t.filters,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new Qi(Hi.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Qi(Hi.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class od{convertValue(t,e="none"){switch(eo(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Hs(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Qs(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw zi()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return Rs(t,((t,r)=>{n[t]=this.convertValue(r,e)})),n}convertGeoPoint(t){return new Ml(Hs(t.latitude),Hs(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Ys(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Xs(t));default:return null}}convertTimestamp(t){const e=Ks(t);return new cs(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=ls.fromString(t);Gi(Kc(n));const r=new Zs(n.get(1),n.get(3)),i=new gs(n.popFirst(5));return r.isEqual(e)||ji(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}class ad{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class cd extends Wl{constructor(t,e,n,r,i,s){super(t,e,n,r,s),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new ud(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(Xl("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class ud extends cd{data(t={}){return super.data(t)}}class hd{constructor(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new ad(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new ud(this._firestore,this._userDataWriter,n.key,n,new ad(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Qi(Hi.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const r=new ud(t._firestore,t._userDataWriter,n.doc.key,n.doc,new ad(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const r=new ud(t._firestore,t._userDataWriter,e.doc.key,e.doc,new ad(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let i=-1,s=-1;return 0!==e.type&&(i=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),s=n.indexOf(e.doc.key)),{type:ld(e.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function ld(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return zi()}}class dd extends od{constructor(t){super(),this.firestore=t}convertBytes(t){return new kl(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new El(this.firestore,null,e)}}function fd(t,e){const n=yl(t.firestore,Cl),r=function(t,e,...n){if(t=p(t),1===arguments.length&&(e=ss.newId()),fl("doc","path",e),t instanceof wl){const r=ls.fromString(e,...n);return gl(r),new El(t,null,new gs(r))}{if(!(t instanceof El||t instanceof _l))throw new Qi(Hi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(ls.fromString(e,...n));return gl(r),new El(t.firestore,t instanceof _l?t.converter:null,new gs(r))}}(t),i=function(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}(t.converter,e);return function(t,e){return function(t,e){const n=new Wi;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const r=nl(t);try{const t=await function(t,e){const n=Ki(t),r=cs.now(),i=e.reduce(((t,e)=>t.add(e.key)),ya());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let a=ca(),c=ya();return n.os.getEntries(t,i).next((t=>{a=t,a.forEach(((t,e)=>{e.isValidDocument()||(c=c.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,a))).next((i=>{s=i;const o=[];for(const t of e){const e=ja(t,s.get(t.key).overlayedDocument);null!=e&&o.push(new za(t.key,e,vo(e.value.mapValue),Ra.exists(!0)))}return n.mutationQueue.addMutationBatch(t,r,o,e)})).next((e=>{o=e;const r=e.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:la(s)})))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let r=t.Fa[t.currentUser.toKey()];r||(r=new Fs(os)),r=r.insert(e,n),t.Fa[t.currentUser.toKey()]=r}(r,t.batchId,n),await Jh(r,t.changes),await ih(r.remoteStore)}catch(t){const e=yh(t,"Failed to persist write");n.reject(e)}}(await function(t){return ul(t).then((t=>t.syncEngine))}(t),e,n))),n.promise}(Dl(t),e)}(n,[Ul(Vl(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,Ra.exists(!1))]).then((()=>r))}new WeakMap,function(t,e=!0){Fi="10.10.0",tt(new m("firestore",((t,{instanceIdentifier:n,options:r})=>{const i=t.getProvider("app").getImmediate(),s=new Cl(new Zi(t.getProvider("auth-internal")),new rs(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Qi(Hi.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Zs(t.options.projectId,e)}(i,n),i);return r=Object.assign({useFetchStreams:e},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),it(Ri,"4.5.1",t),it(Ri,"4.5.1","esm2017")}(),rt({apiKey:"AIzaSyDGryymBHShv_-BEOvrTZMuI3Hslzucu5k",authDomain:"dove-javascript-training.firebaseapp.com",projectId:"dove-javascript-training",storageBucket:"dove-javascript-training.appspot.com",messagingSenderId:"545170324441",appId:"1:545170324441:web:a3bebdcf854a5ff9de77c8",measurementId:"G-5FNHZXPGJB"});const gd=function(t,e){const n=function(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}(function(t=Q){const e=Y.get(t);if(!e&&t===Q&&o())return rt();if(!e)throw et.create("no-app",{appName:t});return e}(),"firestore").getImmediate({identifier:"(default)"});if(!n._initialized){const t=(t=>{const e=(t=>{var e,n;return null===(n=null===(e=s())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),r]:[e.substring(0,n),r]})("firestore");t&&function(t,e,n,r={}){var s;const o=(t=yl(t,wl))._getSettings(),a=`${e}:${n}`;if("firestore.googleapis.com"!==o.host&&o.host!==a&&qi("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),r.mockUserToken){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=Pi.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",r=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[i(JSON.stringify({alg:"none",type:"JWT"})),i(JSON.stringify(o)),""].join(".")}(r.mockUserToken,null===(s=t._app)||void 0===s?void 0:s.options.projectId);const o=r.mockUserToken.sub||r.mockUserToken.user_id;if(!o)throw new Qi(Hi.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Pi(o)}t._authCredentials=new Ji(new Yi(e,n))}}(n,...t)}return n}();function pd(t){return pd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pd(t)}function md(){md=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function h(t,e,n,r){var s=e&&e.prototype instanceof y?e:y,o=Object.create(s.prototype),a=new N(r||[]);return i(o,"_invoke",{value:C(t,n,a)}),o}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var d="suspendedStart",f="suspendedYield",g="executing",p="completed",m={};function y(){}function v(){}function w(){}var b={};u(b,o,(function(){return this}));var E=Object.getPrototypeOf,_=E&&E(E(x([])));_&&_!==n&&r.call(_,o)&&(b=_);var T=w.prototype=y.prototype=Object.create(b);function S(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function I(t,e){function n(i,s,o,a){var c=l(t[i],t,s);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==pd(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,o,a)}),(function(t){n("throw",t,o,a)})):e.resolve(h).then((function(t){u.value=t,o(u)}),(function(t){return n("throw",t,o,a)}))}a(c.arg)}var s;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return s=s?s.then(i,i):i()}})}function C(e,n,r){var i=d;return function(s,o){if(i===g)throw Error("Generator is already running");if(i===p){if("throw"===s)throw o;return{value:t,done:!0}}for(r.method=s,r.arg=o;;){var a=r.delegate;if(a){var c=D(a,r);if(c){if(c===m)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===d)throw i=p,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=g;var u=l(e,n,r);if("normal"===u.type){if(i=r.done?p:f,u.arg===m)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=p,r.method="throw",r.arg=u.arg)}}}function D(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,D(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var s=l(i,e.iterator,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,m;var o=s.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function x(e){if(e||""===e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return s.next=s}}throw new TypeError(pd(e)+" is not iterable")}return v.prototype=w,i(T,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:v,configurable:!0}),v.displayName=u(w,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,c,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(I.prototype),u(I.prototype,a,(function(){return this})),e.AsyncIterator=I,e.async=function(t,n,r,i,s){void 0===s&&(s=Promise);var o=new I(h(t,n,r,i),s);return e.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(T),u(T,c,"Generator"),u(T,o,(function(){return this})),u(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=x,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return a.type="throw",a.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,m):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:x(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),m}},e}function yd(t,e,n,r,i,s,o){try{var a=t[s](o),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}function vd(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,wd(r.key),r)}}function wd(t){var e=function(t,e){if("object"!=pd(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=pd(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==pd(e)?e:e+""}var bd=function(){return t=function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=e,this.currUser=n,this.todoLists=Tl(gd,"todoList"),this.todos=Tl(gd,"todoList",e,"todos"),this.unsub},e=[{key:"addTodo",value:(n=md().mark((function t(e,n,r,i){var s,o,a;return md().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=new Date,o={title:e,notes:n,dueDate:i,assignedTo:r,createdBy:this.currUser,createdAt:cs.fromDate(s)},t.next=4,fd(this.todos,o);case 4:return a=t.sent,t.abrupt("return",a);case 6:case"end":return t.stop()}}),t,this)})),r=function(){var t=this,e=arguments;return new Promise((function(r,i){var s=n.apply(t,e);function o(t){yd(s,r,i,o,a,"next",t)}function a(t){yd(s,r,i,o,a,"throw",t)}o(void 0)}))},function(t,e,n,i){return r.apply(this,arguments)})},{key:"getTodos",value:function(t){var e=function(t,e,...n){let r=[];e instanceof Jl&&r.push(e),r=r.concat(n),function(t){const e=t.filter((t=>t instanceof ed)).length,n=t.filter((t=>t instanceof td)).length;if(e>1||e>0&&n>0)throw new Qi(Hi.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const e of r)t=e._apply(t);return t}(this.todos,function(t,e="asc"){const n=e,r=Xl("orderBy","createdAt");return nd._create(r,n)}());this.unsub=function(t,...e){var n,r,i;t=p(t);let s={includeMetadataChanges:!1,source:"default"},o=0;"object"!=typeof e[o]||Il(e[o])||(s=e[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Il(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(r=t.error)||void 0===r?void 0:r.bind(t),e[o+2]=null===(i=t.complete)||void 0===i?void 0:i.bind(t)}let c,u,h;if(t instanceof El)u=yl(t.firestore,Cl),h=Ho(t._key.path),c={next:n=>{e[o]&&e[o](function(t,e,n){const r=n.docs.get(e._key),i=new dd(t);return new cd(t,i,e._key,r,new ad(n.hasPendingWrites,n.fromCache),e.converter)}(u,t,n))},error:e[o+1],complete:e[o+2]};else{const n=yl(t,bl);u=yl(n.firestore,Cl),h=n._query;const r=new dd(u);c={next:t=>{e[o]&&e[o](new hd(u,r,n,t))},error:e[o+1],complete:e[o+2]},function(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new Qi(Hi.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query)}return function(t,e,n,r){const i=new sl(r),s=new Ah(e,i,n);return t.asyncQueue.enqueueAndForget((async()=>async function(t,e){const n=Ki(t);let r=3;const i=e.query;let s=n.queries.get(i);s?!s.K_()&&e.U_()&&(r=2):(s=new Eh,r=e.U_()?0:1);try{switch(r){case 0:s.q_=await n.onListen(i,!0);break;case 1:s.q_=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(t){const n=yh(t,`Initialization of query '${na(e.query)}' failed`);return void e.onError(n)}n.queries.set(i,s),s.Q_.push(e),e.G_(n.onlineState),s.q_&&e.z_(s.q_)&&Ih(n)}(await hl(t),s))),()=>{i.Qa(),t.asyncQueue.enqueueAndForget((async()=>async function(t,e){const n=Ki(t),r=e.query;let i=3;const s=n.queries.get(r);if(s){const t=s.Q_.indexOf(e);t>=0&&(s.Q_.splice(t,1),0===s.Q_.length?i=e.U_()?0:1:!s.K_()&&e.U_()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}(await hl(t),s)))}}(Dl(u),h,a,c)}(e,(function(e){e.docChanges().forEach((function(e){"added"===e.type&&t(e.doc.data())}))}))}},{key:"updateName",value:function(t){this.currUser=t,localStorage.setItem("currUser",t)}},{key:"updateList",value:function(t){this.id=t,this.unsub&&this.unsub()}}],e&&vd(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r}();const Ed=bd,_d={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function Td(t){return(e={})=>{const n=e.width?String(e.width):t.defaultWidth;return t.formats[n]||t.formats[t.defaultWidth]}}const Sd={date:Td({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:Td({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:Td({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},Id={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function Cd(t){return(e,n)=>{let r;if("formatting"===(n?.context?String(n.context):"standalone")&&t.formattingValues){const e=t.defaultFormattingWidth||t.defaultWidth,i=n?.width?String(n.width):e;r=t.formattingValues[i]||t.formattingValues[e]}else{const e=t.defaultWidth,i=n?.width?String(n.width):t.defaultWidth;r=t.values[i]||t.values[e]}return r[t.argumentCallback?t.argumentCallback(e):e]}}function Dd(t){return(e,n={})=>{const r=n.width,i=r&&t.matchPatterns[r]||t.matchPatterns[t.defaultMatchWidth],s=e.match(i);if(!s)return null;const o=s[0],a=r&&t.parsePatterns[r]||t.parsePatterns[t.defaultParseWidth],c=Array.isArray(a)?function(t,e){for(let e=0;e<t.length;e++)if(t[e].test(o))return e}(a):function(t,e){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)&&t[e].test(o))return e}(a);let u;return u=t.valueCallback?t.valueCallback(c):c,u=n.valueCallback?n.valueCallback(u):u,{value:u,rest:e.slice(o.length)}}}var Ad;const kd={code:"en-US",formatDistance:(t,e,n)=>{let r;const i=_d[t];return r="string"==typeof i?i:1===e?i.one:i.other.replace("{{count}}",e.toString()),n?.addSuffix?n.comparison&&n.comparison>0?"in "+r:r+" ago":r},formatLong:Sd,formatRelative:(t,e,n,r)=>Id[t],localize:{ordinalNumber:(t,e)=>{const n=Number(t),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},era:Cd({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:Cd({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:t=>t-1}),month:Cd({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:Cd({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:Cd({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:(Ad={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:t=>parseInt(t,10)},(t,e={})=>{const n=t.match(Ad.matchPattern);if(!n)return null;const r=n[0],i=t.match(Ad.parsePattern);if(!i)return null;let s=Ad.valueCallback?Ad.valueCallback(i[0]):i[0];return s=e.valueCallback?e.valueCallback(s):s,{value:s,rest:t.slice(r.length)}}),era:Dd({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:Dd({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:t=>t+1}),month:Dd({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:Dd({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:Dd({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}};let Nd={};function xd(){return Nd}Math.pow(10,8);const Md=6048e5,Ld=864e5;function Od(t){const e=Object.prototype.toString.call(t);return t instanceof Date||"object"==typeof t&&"[object Date]"===e?new t.constructor(+t):"number"==typeof t||"[object Number]"===e||"string"==typeof t||"[object String]"===e?new Date(t):new Date(NaN)}function Rd(t){const e=Od(t);return e.setHours(0,0,0,0),e}function Pd(t){const e=Od(t),n=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return n.setUTCFullYear(e.getFullYear()),+t-+n}function Fd(t,e){return t instanceof Date?new t.constructor(e):new Date(e)}function Vd(t){const e=Od(t);return function(t,e){const n=Rd(t),r=Rd(e),i=+n-Pd(n),s=+r-Pd(r);return Math.round((i-s)/Ld)}(e,function(t){const e=Od(t),n=Fd(t,0);return n.setFullYear(e.getFullYear(),0,1),n.setHours(0,0,0,0),n}(e))+1}function Ud(t,e){const n=xd(),r=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??n.weekStartsOn??n.locale?.options?.weekStartsOn??0,i=Od(t),s=i.getDay(),o=(s<r?7:0)+s-r;return i.setDate(i.getDate()-o),i.setHours(0,0,0,0),i}function Bd(t){return Ud(t,{weekStartsOn:1})}function jd(t){const e=Od(t),n=e.getFullYear(),r=Fd(t,0);r.setFullYear(n+1,0,4),r.setHours(0,0,0,0);const i=Bd(r),s=Fd(t,0);s.setFullYear(n,0,4),s.setHours(0,0,0,0);const o=Bd(s);return e.getTime()>=i.getTime()?n+1:e.getTime()>=o.getTime()?n:n-1}function qd(t){const e=Od(t),n=+Bd(e)-+function(t){const e=jd(t),n=Fd(t,0);return n.setFullYear(e,0,4),n.setHours(0,0,0,0),Bd(n)}(e);return Math.round(n/Md)+1}function $d(t,e){const n=Od(t),r=n.getFullYear(),i=xd(),s=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??i.firstWeekContainsDate??i.locale?.options?.firstWeekContainsDate??1,o=Fd(t,0);o.setFullYear(r+1,0,s),o.setHours(0,0,0,0);const a=Ud(o,e),c=Fd(t,0);c.setFullYear(r,0,s),c.setHours(0,0,0,0);const u=Ud(c,e);return n.getTime()>=a.getTime()?r+1:n.getTime()>=u.getTime()?r:r-1}function zd(t,e){const n=Od(t),r=+Ud(n,e)-+function(t,e){const n=xd(),r=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??n.firstWeekContainsDate??n.locale?.options?.firstWeekContainsDate??1,i=$d(t,e),s=Fd(t,0);return s.setFullYear(i,0,r),s.setHours(0,0,0,0),Ud(s,e)}(n,e);return Math.round(r/Md)+1}function Gd(t,e){return(t<0?"-":"")+Math.abs(t).toString().padStart(e,"0")}const Kd={y(t,e){const n=t.getFullYear(),r=n>0?n:1-n;return Gd("yy"===e?r%100:r,e.length)},M(t,e){const n=t.getMonth();return"M"===e?String(n+1):Gd(n+1,2)},d:(t,e)=>Gd(t.getDate(),e.length),a(t,e){const n=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];default:return"am"===n?"a.m.":"p.m."}},h:(t,e)=>Gd(t.getHours()%12||12,e.length),H:(t,e)=>Gd(t.getHours(),e.length),m:(t,e)=>Gd(t.getMinutes(),e.length),s:(t,e)=>Gd(t.getSeconds(),e.length),S(t,e){const n=e.length,r=t.getMilliseconds();return Gd(Math.trunc(r*Math.pow(10,n-3)),e.length)}},Hd={G:function(t,e,n){const r=t.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});default:return n.era(r,{width:"wide"})}},y:function(t,e,n){if("yo"===e){const e=t.getFullYear(),r=e>0?e:1-e;return n.ordinalNumber(r,{unit:"year"})}return Kd.y(t,e)},Y:function(t,e,n,r){const i=$d(t,r),s=i>0?i:1-i;return"YY"===e?Gd(s%100,2):"Yo"===e?n.ordinalNumber(s,{unit:"year"}):Gd(s,e.length)},R:function(t,e){return Gd(jd(t),e.length)},u:function(t,e){return Gd(t.getFullYear(),e.length)},Q:function(t,e,n){const r=Math.ceil((t.getMonth()+1)/3);switch(e){case"Q":return String(r);case"QQ":return Gd(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(t,e,n){const r=Math.ceil((t.getMonth()+1)/3);switch(e){case"q":return String(r);case"qq":return Gd(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(t,e,n){const r=t.getMonth();switch(e){case"M":case"MM":return Kd.M(t,e);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(t,e,n){const r=t.getMonth();switch(e){case"L":return String(r+1);case"LL":return Gd(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(t,e,n,r){const i=zd(t,r);return"wo"===e?n.ordinalNumber(i,{unit:"week"}):Gd(i,e.length)},I:function(t,e,n){const r=qd(t);return"Io"===e?n.ordinalNumber(r,{unit:"week"}):Gd(r,e.length)},d:function(t,e,n){return"do"===e?n.ordinalNumber(t.getDate(),{unit:"date"}):Kd.d(t,e)},D:function(t,e,n){const r=Vd(t);return"Do"===e?n.ordinalNumber(r,{unit:"dayOfYear"}):Gd(r,e.length)},E:function(t,e,n){const r=t.getDay();switch(e){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(t,e,n,r){const i=t.getDay(),s=(i-r.weekStartsOn+8)%7||7;switch(e){case"e":return String(s);case"ee":return Gd(s,2);case"eo":return n.ordinalNumber(s,{unit:"day"});case"eee":return n.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(i,{width:"short",context:"formatting"});default:return n.day(i,{width:"wide",context:"formatting"})}},c:function(t,e,n,r){const i=t.getDay(),s=(i-r.weekStartsOn+8)%7||7;switch(e){case"c":return String(s);case"cc":return Gd(s,e.length);case"co":return n.ordinalNumber(s,{unit:"day"});case"ccc":return n.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(i,{width:"narrow",context:"standalone"});case"cccccc":return n.day(i,{width:"short",context:"standalone"});default:return n.day(i,{width:"wide",context:"standalone"})}},i:function(t,e,n){const r=t.getDay(),i=0===r?7:r;switch(e){case"i":return String(i);case"ii":return Gd(i,e.length);case"io":return n.ordinalNumber(i,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(t,e,n){const r=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(r,{width:"narrow",context:"formatting"});default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},b:function(t,e,n){const r=t.getHours();let i;switch(i=12===r?"noon":0===r?"midnight":r/12>=1?"pm":"am",e){case"b":case"bb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(i,{width:"narrow",context:"formatting"});default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(t,e,n){const r=t.getHours();let i;switch(i=r>=17?"evening":r>=12?"afternoon":r>=4?"morning":"night",e){case"B":case"BB":case"BBB":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(i,{width:"narrow",context:"formatting"});default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(t,e,n){if("ho"===e){let e=t.getHours()%12;return 0===e&&(e=12),n.ordinalNumber(e,{unit:"hour"})}return Kd.h(t,e)},H:function(t,e,n){return"Ho"===e?n.ordinalNumber(t.getHours(),{unit:"hour"}):Kd.H(t,e)},K:function(t,e,n){const r=t.getHours()%12;return"Ko"===e?n.ordinalNumber(r,{unit:"hour"}):Gd(r,e.length)},k:function(t,e,n){let r=t.getHours();return 0===r&&(r=24),"ko"===e?n.ordinalNumber(r,{unit:"hour"}):Gd(r,e.length)},m:function(t,e,n){return"mo"===e?n.ordinalNumber(t.getMinutes(),{unit:"minute"}):Kd.m(t,e)},s:function(t,e,n){return"so"===e?n.ordinalNumber(t.getSeconds(),{unit:"second"}):Kd.s(t,e)},S:function(t,e){return Kd.S(t,e)},X:function(t,e,n){const r=t.getTimezoneOffset();if(0===r)return"Z";switch(e){case"X":return Wd(r);case"XXXX":case"XX":return Yd(r);default:return Yd(r,":")}},x:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"x":return Wd(r);case"xxxx":case"xx":return Yd(r);default:return Yd(r,":")}},O:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+Qd(r,":");default:return"GMT"+Yd(r,":")}},z:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+Qd(r,":");default:return"GMT"+Yd(r,":")}},t:function(t,e,n){return Gd(Math.trunc(t.getTime()/1e3),e.length)},T:function(t,e,n){return Gd(t.getTime(),e.length)}};function Qd(t,e=""){const n=t>0?"-":"+",r=Math.abs(t),i=Math.trunc(r/60),s=r%60;return 0===s?n+String(i):n+String(i)+e+Gd(s,2)}function Wd(t,e){return t%60==0?(t>0?"-":"+")+Gd(Math.abs(t)/60,2):Yd(t,e)}function Yd(t,e=""){const n=t>0?"-":"+",r=Math.abs(t);return n+Gd(Math.trunc(r/60),2)+e+Gd(r%60,2)}const Xd=(t,e)=>{switch(t){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});default:return e.date({width:"full"})}},Jd=(t,e)=>{switch(t){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});default:return e.time({width:"full"})}},Zd={p:Jd,P:(t,e)=>{const n=t.match(/(P+)(p+)?/)||[],r=n[1],i=n[2];if(!i)return Xd(t,e);let s;switch(r){case"P":s=e.dateTime({width:"short"});break;case"PP":s=e.dateTime({width:"medium"});break;case"PPP":s=e.dateTime({width:"long"});break;default:s=e.dateTime({width:"full"})}return s.replace("{{date}}",Xd(r,e)).replace("{{time}}",Jd(i,e))}},tf=/^D+$/,ef=/^Y+$/,nf=["D","DD","YY","YYYY"];function rf(t){if(!(e=t,e instanceof Date||"object"==typeof e&&"[object Date]"===Object.prototype.toString.call(e)||"number"==typeof t))return!1;var e;const n=Od(t);return!isNaN(Number(n))}const sf=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,of=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,af=/^'([^]*?)'?$/,cf=/''/g,uf=/[a-zA-Z]/;function hf(t){const e=t.match(af);return e?e[1].replace(cf,"'"):t}function lf(t){return lf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lf(t)}function df(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ff(r.key),r)}}function ff(t){var e=function(t,e){if("object"!=lf(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=lf(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==lf(e)?e:e+""}const gf=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.element=e},(e=[{key:"render",value:function(t){var e=function(t,e,n){const r=xd(),i=n?.locale??r.locale??kd,s=n?.firstWeekContainsDate??n?.locale?.options?.firstWeekContainsDate??r.firstWeekContainsDate??r.locale?.options?.firstWeekContainsDate??1,o=n?.weekStartsOn??n?.locale?.options?.weekStartsOn??r.weekStartsOn??r.locale?.options?.weekStartsOn??0,a=Od(t);if(!rf(a))throw new RangeError("Invalid time value");let c=e.match(of).map((t=>{const e=t[0];return"p"===e||"P"===e?(0,Zd[e])(t,i.formatLong):t})).join("").match(sf).map((t=>{if("''"===t)return{isToken:!1,value:"'"};const e=t[0];if("'"===e)return{isToken:!1,value:hf(t)};if(Hd[e])return{isToken:!0,value:t};if(e.match(uf))throw new RangeError("Format string contains an unescaped latin alphabet character `"+e+"`");return{isToken:!1,value:t}}));i.localize.preprocessor&&(c=i.localize.preprocessor(a,c));const u={firstWeekContainsDate:s,weekStartsOn:o,locale:i};return c.map((r=>{if(!r.isToken)return r.value;const s=r.value;return(!n?.useAdditionalWeekYearTokens&&function(t){return ef.test(t)}(s)||!n?.useAdditionalDayOfYearTokens&&function(t){return tf.test(t)}(s))&&function(t,e,n){const r=function(t,e,n){const r="Y"===t[0]?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${e}\`) for formatting ${r} to the input \`${n}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}(t,e,n);if(console.warn(r),nf.includes(t))throw new RangeError(r)}(s,e,String(t)),(0,Hd[s[0]])(a,s,i.localize,u)})).join("")}(t.dueDate.toDate(),"eee, M/d/Y"),n='\n        <li class="list-group-item">\n            <div class="row">\n                <div class="col-6">\n                    <p class="lead">'.concat(t.title,'</p>\n                    <p class="text-muted">').concat(t.notes,'</p>\n                </div>\n                <div class="col-3 text-end">\n                    <p><small>Assigned to: </small>').concat(t.assignedTo,"</p>\n                    <p><small>Due: </small>").concat(e,'</p>\n                </div>\n                <div class="col-3 text-center align-items-center">\n                    <button type="button" class="btn btn-secondary">I\'m Done</button>\n                </div>\n            </div>\n        </li>\n        ');this.element.innerHTML+=n}},{key:"clear",value:function(){this.element.innerHTML=""}}])&&df(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();var pf=document.querySelector("#todoList"),mf=new Ed("BjJ1l7ulF10Ib12oOHCJ","Stephen"),yf=new gf(pf);yf.clear(),console.log(mf),mf.getTodos((function(t){yf.render(t),console.log(t)}))})();